# 前端开发需求

## 后端接口参考

前端页面涉及到后端服务接口的调用时，需要参考 [app/后端服务接口规范.md](../app/后端服务接口规范.md)。

## 前端功能开发计划

### 状态说明
- ✅ **已完成**
- 📅 **计划中**
- ⏳ **待定**

### 功能列表

#### 1. 报告组件封装 (ReportComponent)

- 📅 **报告组件的创建与封装**
  - 描述：创建独立的Vue组件（ReportComponent.vue），用于封装分析任务报告的展示逻辑，使其可在股票分析页面及其他页面复用。
  - 技术要求：
    - 组件接收分析任务ID（analysisId）作为props。
    - 支持导航方式展示多个报告（如不同阶段的报告：市场分析报告、基本面分析报告、最终交易决策报告等）。
    - 使用Vue Router或内置tabs/accordion实现导航。
    - 集成Markdown渲染库（如marked + DOMPurify，或VueMarkdownEditor）以富文本方式渲染报告内容，确保安全渲染（防止XSS）。

- 📅 **报告数据获取与展示**
  - 描述：组件通过后端API获取指定任务ID的报告数据，并在界面中渲染。
  - 技术要求：
    - 调用 `GET /api/analysis/{analysis_id}/reports` 接口获取报告列表。
    - 响应数据结构预期：
      ```json
      {
        "analysis_id": "任务ID",
        "reports": [
          {
            "report_id": "唯一ID",
            "title": "报告标题（如'市场分析报告'）",
            "stage": "报告阶段（如'market_analysis'）",
            "content": "Markdown格式的报告内容",
            "created_at": "创建时间",
            "markdown": true
          }
        ]
      }
      ```
    - 支持加载状态、错误处理（如空报告、无权限）。
    - 导航UI：使用tabs（每个tab对应一个报告）或侧边栏列表+主内容区，便于切换不同报告。

- 📅 **集成到股票分析页面**
  - 描述：在现有股票分析页面（StockAnalysis.vue）中，分析完成后加载报告组件。
  - 要求：
    - 在分析任务完成事件（通过WebSocket或轮询）后，动态渲染报告组件，传入analysisId。
    - 确保组件响应式，报告数据更新时自动刷新。
    - 样式要求：响应式设计，支持桌面/移动端；使用Tailwind CSS保持一致性。

#### 2. Markdown富文本渲染

- 📅 **Markdown内容渲染**
  - 描述：对API返回的Markdown格式报告内容进行富文本渲染。
  - 技术要求：
    - 使用库如marked解析Markdown，支持代码高亮（highlight.js）、图片/表格渲染。
    - 安全处理：使用DOMPurify净化HTML输出。
    - 支持自定义样式：报告标题用H1-H3，表格带边框，代码块带背景色。

#### 3. 导航与用户交互

- 📅 **多报告导航支持**
  - 描述：如果任务包含多个报告（如分析师报告、辩论报告、最终报告），提供导航机制。
  - 要求：
    - 默认显示最终报告，可切换查看子报告。
    - 导航项显示标题、阶段图标（可选）。
    - 支持搜索或过滤报告（若报告数量多）。

### 开发优先级

| 优先级 | 功能 | 说明 |
|--------|------|------|
| P0 | 报告组件创建与API集成 | 核心展示逻辑，确保数据获取和基本渲染 |
| P1 | Markdown渲染与导航 | 提升用户体验，支持多报告切换 |
| P2 | 页面集成与样式优化 | 完成股票分析页面的报告展示 |

---

## 后端接口需求分析

### 现有接口（已满足）

| 接口 | 说明 | 状态 |
|------|------|------|
| `GET /api/analysis/{id}/status` | 获取任务状态 | ✅ 可用 |
| `WS /ws/notifications` | 实时消息推送 | ✅ 可用 |

### 需要新增/调整的接口

为满足报告组件需求，后端接口需要新增报告数据接口：

#### 1. 📋 **报告数据获取接口**（新增）

**接口**: `GET /api/analysis/{analysis_id}/reports`

**功能**: 根据分析任务ID返回该任务的所有报告数据，支持导航展示。

**请求参数**:
- Path: `analysis_id` (str) - 分析任务ID

**响应示例**:
```json
{
  "success": true,
  "data": {
    "analysis_id": "123456",
    "reports": [
      {
        "report_id": "report_001",
        "title": "市场分析报告",
        "stage": "market_analyst",
        "content": "# 市场趋势分析\n\n报告内容以Markdown格式...",
        "created_at": "2025-12-10T18:00:00Z",
        "file_path": "/results/123456/reports/market_report.md"  // 可选，文件路径备份
      },
      {
        "report_id": "report_002",
        "title": "最终交易决策",
        "stage": "final_decision",
        "content": "# 交易建议\n\n买入AAPL...",
        "created_at": "2025-12-10T18:05:00Z"
      }
    ]
  },
  "message": "报告获取成功"
}
```

**错误响应**:
```json
{
  "success": false,
  "error": "Analysis ID not found",
  "code": 404
}
```

**实现注意**:
- 数据来源：从任务结果目录（如results/{id}/reports/）读取Markdown文件，或从数据库查询。
- 安全性：验证用户权限，仅返回所属任务的报告。
- 优化：若报告内容过长，支持分页或摘要。

### 接口需求优先级

| 优先级 | 接口需求 | 说明 |
|--------|----------|------|
| P0 | 新增报告获取接口 | 核心数据提供，用于组件渲染 |
| P1 | 响应格式标准化 | 确保包含标题、内容、阶段等字段 |
