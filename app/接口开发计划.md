# TradingAgents åç«¯æ¥å£å¼€å‘è®¡åˆ’

## æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£åŸºäº `åç«¯æœåŠ¡è®¾è®¡å‚è€ƒ.md` åˆ¶å®šï¼Œè®°å½•äº† TradingAgents åç«¯ API çš„å¼€å‘è®¡åˆ’å’Œå½“å‰çŠ¶æ€ã€‚æ¯ä¸ªæ¥å£æ ‡æ³¨äº†å½“å‰çŠ¶æ€ï¼š**å·²å®Œæˆ** æˆ– **è®¡åˆ’ä¸­**ã€‚

**æ›´æ–°æ—¶é—´**: 2025-12-02

---

## æ‰¹æ¬¡1: åŸºç¡€è®¾ç½®å’Œå¥åº·æ£€æŸ¥

### ç›®æ ‡
å¢å¼º main.py çš„å®‰å…¨æ€§å’Œç›‘æ§åŸºç¡€ï¼Œæ·»åŠ å¥åº·æ£€æŸ¥æ¥å£ã€‚

### æ¥å£åˆ—è¡¨

#### 1. GET /api/health
- **çŠ¶æ€**: âœ… **å·²å®Œæˆ**
- **åŠŸèƒ½**: è¿”å›åº”ç”¨å¥åº·çŠ¶æ€
- **å“åº”ç¤ºä¾‹**:
  ```json
  {
    "status": "healthy",
    "version": "0.1.0",
    "timestamp": 1701504000
  }
  ```
- **å®ç°æ–‡ä»¶**: `app/routers/health.py`

#### 2. GET /
- **çŠ¶æ€**: âœ… **å·²å®Œæˆ**
- **åŠŸèƒ½**: è¿”å› API åŸºæœ¬ä¿¡æ¯å’Œç‰ˆæœ¬
- **å“åº”ç¤ºä¾‹**:
  ```json
  {
    "name": "TradingAgents-CN API",
    "version": "0.1.0",
    "status": "healthy",
    "docs_url": "/docs"
  }
  ```
- **å®ç°æ–‡ä»¶**: `app/main.py`

### åŸºç¡€è®¾æ–½
- âœ… CORS ä¸­é—´ä»¶é…ç½®
- âœ… TrustedHost ä¸­é—´ä»¶ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- âœ… é…ç½®ç®¡ç† (`app/core/config.py`)
- âœ… å¯åŠ¨éªŒè¯ (`app/core/startup_validator.py`)

---

## æ‰¹æ¬¡2: å¢å¼ºåˆ†ææ¨¡å—

### ç›®æ ‡
æ‰©å±•æ ¸å¿ƒè‚¡ç¥¨åˆ†æåŠŸèƒ½ï¼Œæ”¯æŒå¼‚æ­¥ä»»åŠ¡ã€è¿›åº¦è·Ÿè¸ªå’Œä»»åŠ¡æ§åˆ¶ã€‚

### æ¥å£åˆ—è¡¨

#### 1. POST /api/analysis/start
- **çŠ¶æ€**: âœ… **å·²å®Œæˆ**
- **åŠŸèƒ½**: å¯åŠ¨è‚¡ç¥¨åˆ†æä»»åŠ¡ï¼ˆå¼‚æ­¥ï¼‰
- **è¯·æ±‚å‚æ•°**:
  ```json
  {
    "stock_symbol": "AAPL",
    "market_type": "ç¾è‚¡",
    "analysis_date": "2025-12-02",
    "analysts": ["market_analyst", "fundamental_analyst"],
    "research_depth": 3,
    "include_sentiment": true,
    "include_risk_assessment": true,
    "custom_prompt": "å¯é€‰çš„è‡ªå®šä¹‰åˆ†ææç¤º",
    "extra_config": {
      "llm_provider": "dashscope",
      "llm_model": "qwen-max"
    }
  }
  ```
- **å“åº”ç¤ºä¾‹**:
  ```json
  {
    "analysis_id": "uuid-string",
    "status": "pending",
    "message": "Analysis task started"
  }
  ```
- **å®ç°æ–‡ä»¶**: `app/routers/analysis.py`

#### 2. GET /api/analysis/{analysis_id}/status
- **çŠ¶æ€**: âœ… **å·²å®Œæˆ**
- **åŠŸèƒ½**: æŸ¥è¯¢åˆ†æä»»åŠ¡çŠ¶æ€å’Œè¿›åº¦
- **å“åº”ç¤ºä¾‹**:
  ```json
  {
    "analysis_id": "uuid-string",
    "status": "running",
    "current_message": "æ­£åœ¨æ‰§è¡ŒåŸºæœ¬é¢åˆ†æ...",
    "progress_log": [
      {
        "message": "åˆå§‹åŒ–åˆ†æç¯å¢ƒ",
        "step": 1,
        "total_steps": 5,
        "timestamp": "2025-12-02T14:30:00"
      }
    ],
    "error": null
  }
  ```
- **å®ç°æ–‡ä»¶**: `app/routers/analysis.py`

#### 3. GET /api/analysis/{analysis_id}/result
- **çŠ¶æ€**: âœ… **å·²å®Œæˆ**
- **åŠŸèƒ½**: è·å–å·²å®Œæˆçš„åˆ†æç»“æœ
- **å“åº”**: å®Œæ•´çš„åˆ†ææŠ¥å‘Šå¯¹è±¡
- **å®ç°æ–‡ä»¶**: `app/routers/analysis.py`

#### 4. POST /api/analysis/{analysis_id}/pause
- **çŠ¶æ€**: âœ… **å·²å®Œæˆ**
- **åŠŸèƒ½**: æš‚åœæ­£åœ¨è¿è¡Œçš„åˆ†æä»»åŠ¡
- **å®ç°æ–‡ä»¶**: `app/routers/analysis.py`

#### 5. POST /api/analysis/{analysis_id}/resume
- **çŠ¶æ€**: âœ… **å·²å®Œæˆ**
- **åŠŸèƒ½**: æ¢å¤å·²æš‚åœçš„åˆ†æä»»åŠ¡
- **å®ç°æ–‡ä»¶**: `app/routers/analysis.py`

#### 6. POST /api/analysis/{analysis_id}/stop
- **çŠ¶æ€**: âœ… **å·²å®Œæˆ**
- **åŠŸèƒ½**: åœæ­¢åˆ†æä»»åŠ¡
- **å®ç°æ–‡ä»¶**: `app/routers/analysis.py`

### æ ¸å¿ƒåŠŸèƒ½
- âœ… å¼‚æ­¥ä»»åŠ¡å¤„ç†ï¼ˆBackgroundTasksï¼‰
- âœ… ä»»åŠ¡çŠ¶æ€ç®¡ç†ï¼ˆpending/running/paused/stopped/completed/failedï¼‰
- âœ… è¿›åº¦è·Ÿè¸ªå’Œæ—¥å¿—è®°å½•
- âœ… ä»»åŠ¡æ§åˆ¶ï¼ˆæš‚åœ/æ¢å¤/åœæ­¢ï¼‰
- âœ… é›†æˆ `tradingagents.utils.analysis_runner`
- âœ… é›†æˆ `tradingagents.utils.task_control_manager`

---

## æ‰¹æ¬¡3: æŠ¥å‘Šå’Œé€šçŸ¥åŸºç¡€

### ç›®æ ‡
æ·»åŠ æŠ¥å‘Šç”Ÿæˆå’Œç®€å•é€šçŸ¥åŠŸèƒ½ã€‚

### æ¥å£åˆ—è¡¨

#### 1. POST /reports/generate
- **çŠ¶æ€**: âœ… **å·²å®Œæˆ**
- **åŠŸèƒ½**: ç”Ÿæˆåˆ†ææŠ¥å‘Šï¼ˆæ”¯æŒ MD/PDF/DOCX æ ¼å¼ï¼‰
- **è¯·æ±‚å‚æ•°**:
  ```json
  {
    "analysis_id": "uuid-string",
    "format": "pdf",
    "include_charts": true
  }
  ```
- **å®ç°æ–‡ä»¶**: `app/routers/reports.py`, `app/services/report_service.py`

#### 2. GET /reports/{report_id}
- **çŠ¶æ€**: âœ… **å·²å®Œæˆ**
- **åŠŸèƒ½**: ä¸‹è½½ç”Ÿæˆçš„æŠ¥å‘Šæ–‡ä»¶
- **å®ç°æ–‡ä»¶**: `app/routers/reports.py`

#### 3. POST /api/notifications
- **çŠ¶æ€**: âœ… **å·²å®Œæˆ**
- **åŠŸèƒ½**: å‘é€é€šçŸ¥ï¼ˆåˆ†æå®Œæˆã€é”™è¯¯è­¦æŠ¥ç­‰ï¼‰
- **è¯·æ±‚å‚æ•°**:
  ```json
  {
    "type": "analysis_complete",
    "analysis_id": "uuid-string",
    "message": "è‚¡ç¥¨åˆ†æå·²å®Œæˆ"
  }
  ```
- **å®ç°æ–‡ä»¶**: `app/routers/notifications.py`, `app/services/notification_service.py`
- **å®ç°æ–‡ä»¶**: `app/routers/notifications.py`, `app/services/notification_service.py`
- **å¤‡æ³¨**: åŸºç¡€é€šçŸ¥æ¥å£

#### 4. WS /ws/notifications
- **çŠ¶æ€**: âœ… **å·²å®Œæˆ**
- **åŠŸèƒ½**: WebSocket å®æ—¶é€šçŸ¥æ¨é€
- **å®ç°æ–‡ä»¶**: `app/routers/websocket.py`, `app/services/websocket_manager.py`

---

## æ‰¹æ¬¡4: ç”¨æˆ·è®¤è¯å’Œæ”¶è—

### ç›®æ ‡
æ·»åŠ åŸºæœ¬ç”¨æˆ·è®¤è¯å’Œä¸ªæ€§åŒ–åŠŸèƒ½ã€‚

### æ¥å£åˆ—è¡¨

#### 1. POST /api/auth/login
- **çŠ¶æ€**: ğŸ“‹ **è®¡åˆ’ä¸­**
- **åŠŸèƒ½**: ç”¨æˆ·ç™»å½•ï¼Œè¿”å› JWT ä»¤ç‰Œ
- **è¯·æ±‚å‚æ•°**:
  ```json
  {
    "username": "user@example.com",
    "password": "password"
  }
  ```
- **å“åº”ç¤ºä¾‹**:
  ```json
  {
    "access_token": "jwt-token-string",
    "token_type": "bearer",
    "expires_in": 3600
  }
  ```
- **è®¡åˆ’å®ç°**: æ‰¹æ¬¡4

#### 2. POST /api/auth/register
- **çŠ¶æ€**: ğŸ“‹ **è®¡åˆ’ä¸­**
- **åŠŸèƒ½**: ç”¨æˆ·æ³¨å†Œ
- **è®¡åˆ’å®ç°**: æ‰¹æ¬¡4

#### 3. POST /api/favorites
- **çŠ¶æ€**: ğŸ“‹ **è®¡åˆ’ä¸­**
- **åŠŸèƒ½**: æ·»åŠ æˆ–åˆ é™¤æ”¶è—è‚¡ç¥¨
- **è¯·æ±‚å‚æ•°**:
  ```json
  {
    "stock_symbol": "AAPL",
    "action": "add"
  }
  ```
- **è®¡åˆ’å®ç°**: æ‰¹æ¬¡4
- **ä¾èµ–**: éœ€è¦ç”¨æˆ·è®¤è¯

#### 4. GET /api/favorites
- **çŠ¶æ€**: ğŸ“‹ **è®¡åˆ’ä¸­**
- **åŠŸèƒ½**: è·å–ç”¨æˆ·æ”¶è—çš„è‚¡ç¥¨åˆ—è¡¨
- **è®¡åˆ’å®ç°**: æ‰¹æ¬¡4
- **ä¾èµ–**: éœ€è¦ç”¨æˆ·è®¤è¯

### åŸºç¡€è®¾æ–½éœ€æ±‚
- ğŸ“‹ MongoDB é›†æˆ
- ğŸ“‹ JWT è®¤è¯ä¸­é—´ä»¶
- ğŸ“‹ ç”¨æˆ·æ¨¡å‹å’Œæ•°æ®åº“ Schema
- ğŸ“‹ å¯†ç å“ˆå¸Œå¤„ç†

---

## æ‰¹æ¬¡5: è‚¡ç¥¨æ•°æ®å’Œç­›é€‰

### ç›®æ ‡
æ·»åŠ è‚¡ç¥¨æŸ¥è¯¢å’Œç­›é€‰åŠŸèƒ½ã€‚

### æ¥å£åˆ—è¡¨

#### 1. GET /api/stocks
- **çŠ¶æ€**: ğŸ“‹ **è®¡åˆ’ä¸­**
- **åŠŸèƒ½**: è‚¡ç¥¨åˆ—è¡¨æŸ¥è¯¢ï¼ˆæ”¯æŒå¸‚åœºè¿‡æ»¤ï¼‰
- **æŸ¥è¯¢å‚æ•°**:
  - `market`: Aè‚¡/æ¸¯è‚¡/ç¾è‚¡
  - `page`: é¡µç 
  - `page_size`: æ¯é¡µæ•°é‡
- **è®¡åˆ’å®ç°**: æ‰¹æ¬¡5

#### 2. GET /api/stock-data/{symbol}
- **çŠ¶æ€**: ğŸ“‹ **è®¡åˆ’ä¸­**
- **åŠŸèƒ½**: è·å–è‚¡ç¥¨å®æ—¶/å†å²æ•°æ®
- **æŸ¥è¯¢å‚æ•°**:
  - `data_type`: realtime/historical
  - `start_date`: å¼€å§‹æ—¥æœŸ
  - `end_date`: ç»“æŸæ—¥æœŸ
- **è®¡åˆ’å®ç°**: æ‰¹æ¬¡5
- **ä¾èµ–**: Tushare/AKShare æ•°æ®æº

#### 3. POST /api/screening
- **çŠ¶æ€**: ğŸ“‹ **è®¡åˆ’ä¸­**
- **åŠŸèƒ½**: è‚¡ç¥¨ç­›é€‰ï¼ˆæŒ‰æ¡ä»¶ï¼‰
- **è¯·æ±‚å‚æ•°**:
  ```json
  {
    "market": "Aè‚¡",
    "conditions": {
      "market_cap_min": 10000000000,
      "pe_ratio_max": 30,
      "industry": "ç§‘æŠ€"
    }
  }
  ```
- **è®¡åˆ’å®ç°**: æ‰¹æ¬¡5

#### 4. GET /api/screening/results
- **çŠ¶æ€**: ğŸ“‹ **è®¡åˆ’ä¸­**
- **åŠŸèƒ½**: è·å–ç­›é€‰ç»“æœåˆ—è¡¨
- **è®¡åˆ’å®ç°**: æ‰¹æ¬¡5

---

## æ‰¹æ¬¡6: ç³»ç»Ÿé…ç½®å’Œç›‘æ§

### ç›®æ ‡
æ·»åŠ é…ç½®ç®¡ç†å’Œæ—¥å¿—/ç»Ÿè®¡åŠŸèƒ½ã€‚

### æ¥å£åˆ—è¡¨

#### 1. GET /api/config
- **çŠ¶æ€**: ğŸ“‹ **è®¡åˆ’ä¸­**
- **åŠŸèƒ½**: ç³»ç»Ÿé…ç½®æŸ¥è¯¢ï¼ˆLLM è®¾ç½®ã€æ•°æ®æºé…ç½®ç­‰ï¼‰
- **å“åº”ç¤ºä¾‹**:
  ```json
  {
    "llm_provider": "dashscope",
    "llm_model": "qwen-max",
    "data_sources": ["tushare", "akshare"],
    "cache_enabled": true
  }
  ```
- **è®¡åˆ’å®ç°**: æ‰¹æ¬¡6

#### 2. GET /api/system/operation_logs
- **çŠ¶æ€**: ğŸ“‹ **è®¡åˆ’ä¸­**
- **åŠŸèƒ½**: æ“ä½œæ—¥å¿—åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
- **æŸ¥è¯¢å‚æ•°**:
  - `page`: é¡µç 
  - `page_size`: æ¯é¡µæ•°é‡
  - `start_date`: å¼€å§‹æ—¥æœŸ
  - `end_date`: ç»“æŸæ—¥æœŸ
- **è®¡åˆ’å®ç°**: æ‰¹æ¬¡6

#### 3. GET /usage-statistics
- **çŠ¶æ€**: ğŸ“‹ **è®¡åˆ’ä¸­**
- **åŠŸèƒ½**: ä½¿ç”¨ç»Ÿè®¡ï¼ˆAPI è°ƒç”¨æ¬¡æ•°ã€åˆ†æä»»åŠ¡ç»Ÿè®¡ç­‰ï¼‰
- **å“åº”ç¤ºä¾‹**:
  ```json
  {
    "total_analyses": 1250,
    "analyses_today": 45,
    "api_calls_today": 320,
    "active_users": 28
  }
  ```
- **è®¡åˆ’å®ç°**: æ‰¹æ¬¡6

### åŸºç¡€è®¾æ–½éœ€æ±‚
- ğŸ“‹ æ“ä½œæ—¥å¿—ä¸­é—´ä»¶
- ğŸ“‹ Redis é›†æˆï¼ˆç¼“å­˜å’Œç»Ÿè®¡ï¼‰
- ğŸ“‹ æ—¥å¿—é…ç½®ç®¡ç†

---

## æ‰©å±•åŠŸèƒ½ï¼ˆæœªæ¥è§„åˆ’ï¼‰

ä»¥ä¸‹åŠŸèƒ½æ¥è‡ªå‚è€ƒè®¾è®¡ï¼Œä½†ä¸åœ¨å½“å‰6ä¸ªæ‰¹æ¬¡çš„èŒƒå›´å†…ï¼Œå¯ä½œä¸ºåç»­æ‰©å±•ï¼š

### é«˜çº§é€šçŸ¥
### é«˜çº§é€šçŸ¥
- âœ… WebSocket å®æ—¶é€šçŸ¥ (`/ws/notifications`)
- SSE æµå¼é€šçŸ¥ (`/api/stream`)
- SSE æµå¼é€šçŸ¥ (`/api/stream`)

### æ•°æ®åŒæ­¥
- å¤šæ•°æ®æºåŒæ­¥ (`/multi-source-sync`)
- å†å²æ•°æ®åŒæ­¥ (`/historical-data`)
- è´¢åŠ¡æ•°æ®æŸ¥è¯¢ (`/financial-data`)
- æ–°é—»æ•°æ®åŒæ­¥ (`/news-data`)
- ç¤¾äº¤åª’ä½“æ•°æ® (`/social-media`)

### ä»»åŠ¡è°ƒåº¦
- å®šæ—¶ä»»åŠ¡ç®¡ç† (`/scheduler`)
- ä»»åŠ¡é˜Ÿåˆ—ç®¡ç† (`/api/queue`)

### æ•°æ®æºåˆå§‹åŒ–
- Tushare åˆå§‹åŒ– (`/api/tushare-init`)
- AKShare åˆå§‹åŒ– (`/api/akshare-init`)
- BaoStock åˆå§‹åŒ– (`/api/baostock-init`)

### å…¶ä»–åŠŸèƒ½
- è‚¡ç¥¨æ ‡ç­¾ç®¡ç† (`/api/tags`)
- æ¨¡æ‹Ÿäº¤æ˜“ (`/api/paper`)
- æ•°æ®åº“ç®¡ç† (`/api/system/database`)
- ç¼“å­˜ç®¡ç† (`/cache`)
- å¤šå¸‚åœºè‚¡ç¥¨æ”¯æŒå¢å¼º (`/api/multi-market`)

---

## å¼€å‘è¿›åº¦æ€»ç»“

### å·²å®Œæˆ (æ‰¹æ¬¡1-3)
- âœ… åŸºç¡€æ¡†æ¶å’Œä¸­é—´ä»¶é…ç½®
- âœ… å¥åº·æ£€æŸ¥æ¥å£
- âœ… å®Œæ•´çš„è‚¡ç¥¨åˆ†ææ¥å£ï¼ˆå¼‚æ­¥ã€è¿›åº¦è·Ÿè¸ªã€ä»»åŠ¡æ§åˆ¶ï¼‰
- âœ… ä»»åŠ¡çŠ¶æ€ç®¡ç†
- âœ… æŠ¥å‘Šç”Ÿæˆå’Œå¯¼å‡ºï¼ˆMD/PDF/DOCXï¼‰
- âœ… æŠ¥å‘Šä¸‹è½½åŠŸèƒ½
- âœ… é€šçŸ¥ç³»ç»Ÿï¼ˆç®€åŒ–ç‰ˆï¼‰

- âœ… é€šçŸ¥ç³»ç»Ÿï¼ˆç®€åŒ–ç‰ˆï¼‰
- âœ… WebSocket å®æ—¶é€šçŸ¥

**å®Œæˆæ¥å£æ•°**: 12 ä¸ª

### è®¡åˆ’ä¸­ (æ‰¹æ¬¡3-6)
- ğŸ“‹ æŠ¥å‘Šç”Ÿæˆå’Œå¯¼å‡º
### è®¡åˆ’ä¸­ (æ‰¹æ¬¡3-6)
- ğŸ“‹ æŠ¥å‘Šç”Ÿæˆå’Œå¯¼å‡º
- ğŸ“‹ é€šçŸ¥ç³»ç»Ÿ
- âœ… WebSocket å®æ—¶é€šçŸ¥
- ğŸ“‹ ç”¨æˆ·è®¤è¯å’Œæˆæƒ
- ğŸ“‹ ç”¨æˆ·è®¤è¯å’Œæˆæƒ
- ğŸ“‹ æ”¶è—åŠŸèƒ½
- ğŸ“‹ è‚¡ç¥¨æ•°æ®æŸ¥è¯¢
- ğŸ“‹ è‚¡ç¥¨ç­›é€‰
- ğŸ“‹ ç³»ç»Ÿé…ç½®ç®¡ç†
- ğŸ“‹ æ“ä½œæ—¥å¿—å’Œç»Ÿè®¡

**è®¡åˆ’æ¥å£æ•°**: 12 ä¸ª

### æ€»è®¡
### æ€»è®¡
- **æ€»æ¥å£æ•°**: 24 ä¸ªï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
- **å®Œæˆç‡**: 37.5% (9/24)
- **å½“å‰æ‰¹æ¬¡**: æ‰¹æ¬¡2 å·²å®Œæˆï¼Œå‡†å¤‡è¿›å…¥æ‰¹æ¬¡3

---

## å®æ–½å»ºè®®

1. **æµ‹è¯•ä¼˜å…ˆ**: æ¯ä¸ªæ‰¹æ¬¡å®Œæˆåï¼Œä½¿ç”¨ Postman æˆ– curl æµ‹è¯•æ‰€æœ‰ç«¯ç‚¹
2. **æ–‡æ¡£åŒæ­¥**: åŠæ—¶æ›´æ–° OpenAPI æ–‡æ¡£ï¼ˆ`/docs`ï¼‰
3. **ä»£ç å®¡æŸ¥**: ç¡®ä¿ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒå’Œæœ€ä½³å®è·µ
4. **æ€§èƒ½ç›‘æ§**: æ·»åŠ æ—¥å¿—å’Œæ€§èƒ½æŒ‡æ ‡æ”¶é›†
5. **å®‰å…¨åŠ å›º**: 
   - æ‰¹æ¬¡4 å‰å¿…é¡»å®Œæˆè®¤è¯ç³»ç»Ÿ
   - æ•æ„Ÿæ¥å£æ·»åŠ æƒé™éªŒè¯
   - API é™æµå’Œé˜²æŠ¤

---

## ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | è¯´æ˜ |
|------|------|------|
| 1.0 | 2025-12-02 | åˆå§‹ç‰ˆæœ¬ï¼ŒåŸºäºå‚è€ƒè®¾è®¡æ–‡æ¡£åˆ›å»º |
