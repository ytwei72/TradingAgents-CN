# æŠ¥å‘Šç®¡ç†æ¥å£

## 4.1 ç”ŸæˆæŠ¥å‘Š

**çŠ¶æ€**: ğŸš§ è‰ç¨¿

ä»åˆ†æç»“æœç”Ÿæˆæ ¼å¼åŒ–æŠ¥å‘Šæ–‡ä»¶ã€‚

#### è¯·æ±‚

```http
POST /reports/generate
Content-Type: application/json
```

#### è¯·æ±‚ä½“

```json
{
  "analysis_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "format": "pdf",
  "include_charts": true,
  "language": "zh-CN"
}
```

#### è¯·æ±‚å‚æ•°è¯´æ˜

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| analysis_id | string | âœ… | åˆ†æä»»åŠ¡ ID |
| format | string | âœ… | æŠ¥å‘Šæ ¼å¼ï¼š`pdf` / `markdown` / `docx` |
| include_charts | boolean | âŒ | æ˜¯å¦åŒ…å«å›¾è¡¨ï¼Œé»˜è®¤ true |
| language | string | âŒ | æŠ¥å‘Šè¯­è¨€ï¼š`zh-CN` / `en-US`ï¼Œé»˜è®¤ zh-CN |

#### å“åº”

```json
{
  "report_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890_markdown",
  "status": "completed",
  "message": "æŠ¥å‘Šç”ŸæˆæˆåŠŸ",
  "download_url": "/reports/a1b2c3d4-e5f6-7890-abcd-ef1234567890_markdown",
  "format": "markdown"
}
```

#### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| report_id | string | æŠ¥å‘Š IDï¼ˆæ ¼å¼ï¼š{analysis_id}_{format}ï¼‰ |
| status | string | ç”ŸæˆçŠ¶æ€ï¼š`completed` / `failed` |
| message | string | çŠ¶æ€æ¶ˆæ¯ |
| download_url | string | ä¸‹è½½é“¾æ¥ |
| format | string | æŠ¥å‘Šæ ¼å¼ |

#### é”™è¯¯å“åº”

**åˆ†æä»»åŠ¡ä¸å­˜åœ¨**:
```json
{
  "detail": "åˆ†æä»»åŠ¡ä¸å­˜åœ¨: {analysis_id}"
}
```
HTTP çŠ¶æ€ç : 404

**åˆ†ææœªå®Œæˆ**:
```json
{
  "detail": "åˆ†æä»»åŠ¡æœªå®Œæˆï¼Œå½“å‰çŠ¶æ€: running"
}
```
HTTP çŠ¶æ€ç : 400

**ä¸æ”¯æŒçš„æ ¼å¼**:
```json
{
  "detail": [
    {
      "type": "literal_error",
      "loc": ["body", "format"],
      "msg": "Input should be 'markdown', 'md', 'pdf' or 'docx'"
    }
  ]
}
```
HTTP çŠ¶æ€ç : 422

#### ç¤ºä¾‹

```bash
curl -X POST http://localhost:8000/reports/generate \
  -H "Content-Type: application/json" \
  -d '{
    "analysis_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
    "format": "markdown"
  }'
```

---

## 4.2 ä¸‹è½½æŠ¥å‘Š

**çŠ¶æ€**: ğŸš§ è‰ç¨¿

ä¸‹è½½å·²ç”Ÿæˆçš„æŠ¥å‘Šæ–‡ä»¶ã€‚

#### è¯·æ±‚

```http
GET /reports/{report_id}
```

#### è·¯å¾„å‚æ•°

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| report_id | string | æŠ¥å‘Š ID |

#### å“åº”

è¿”å›æŠ¥å‘Šæ–‡ä»¶ï¼ˆäºŒè¿›åˆ¶æµï¼‰ã€‚

**å“åº”å¤´**:
```
Content-Type: application/pdf | text/markdown | application/vnd.openxmlformats-officedocument.wordprocessingml.document
Content-Disposition: attachment; filename="report_{analysis_id}.{ext}"
```

#### é”™è¯¯å“åº”

**æŠ¥å‘Šä¸å­˜åœ¨**:
```json
{
  "detail": "æŠ¥å‘Šä¸å­˜åœ¨: {report_id}"
}
```
HTTP çŠ¶æ€ç : 404

#### ç¤ºä¾‹

```bash
# ä¸‹è½½æŠ¥å‘Š
curl -O -J http://localhost:8000/reports/a1b2c3d4-e5f6-7890-abcd-ef1234567890_markdown
```

