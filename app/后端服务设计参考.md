后端服务参考设计
根目录下的app目录是一个简化的FastAPI应用，仅提供基本的股票分析接口。参考目录（reference/TradingAgents-CN/app）是一个完整的FastAPI后端，支持多数据源同步、用户认证、批量分析、报告生成等功能。

根app目录接口（app/main.py）：
- GET /: 返回API运行状态消息（{"message": "TradingAgents API is running"}）。
- POST /api/analysis: 接收股票代码（symbol）和交易日期（trade_date，可选），调用TradingAgentsGraph进行分析，返回决策结果（decision）和完整报告（full_report）。这是唯一的业务接口。
  
参考app目录接口（reference/TradingAgents-CN/app/main.py）：
这是一个全面的API系统，通过多个router模块提供接口，支持数据库、缓存、调度任务、多数据源（Tushare、AKShare、BaoStock等）。主要接口按模块分组（基于include_router和端点定义）：

核心/健康检查：
- GET /api/health: 健康检查端点。
  
认证与用户管理：
- /api/auth (auth.router): 用户认证接口（如登录、注册、JWT令牌）。
  
股票分析：
- /api/analysis (analysis.router): 股票分析接口，包括单股分析、批量分析、进度跟踪等（比根app更丰富，支持报告导出、状态更新）。
  
报告生成：
- /reports (reports.router, 无前缀): 报告管理接口（如生成、导出PDF/MD报告）。
  
股票筛选：
- /api/screening (screening.router): 股票筛选接口，支持条件筛选、数据库查询。
  
队列管理：
- /api/queue (queue.router): 任务队列接口（如提交分析任务、监控进度）。
  
收藏与标签：
- /api/favorites (favorites.router): 收藏股票接口。
- /api/tags (tags.router): 股票标签管理。
  
股票数据管理：
- /api/stocks (stocks_router.router): 股票列表查询、管理。
- /api/multi-market (multi_market_stocks_router.router): 多市场股票支持（A股、港股、美股）。
- /stock-data (stock_data_router.router, 无前缀): 股票数据查询（实时/历史）。
- /stock-sync (stock_sync_router.router, 无前缀): 股票数据同步接口。
  
配置与系统：
- /api/config (config.router): 系统配置管理。
- /model-capabilities (model_capabilities.router, 无前缀): 大模型能力配置/查询。
- /usage-statistics (usage_statistics.router, 无前缀): 使用统计接口。
- /api/system/database (database.router): 数据库管理（备份、清理、状态）。
- /cache (cache.router, 无前缀): 缓存操作接口。
- /api/system/operation_logs (operation_logs.router): 操作日志查询。
- /api/system/logs (logs.router): 系统日志导出。
- /api/system (system_config_router.router): 系统配置只读摘要。
  
通知与实时：
- /api/notifications (notifications_router.router): 通知管理（REST API）。
- /api/websocket (websocket_notifications_router.router): WebSocket通知（实时推送）。
- /api/stream (sse.router): SSE（Server-Sent Events）流式通知。
- /scheduler (scheduler_router.router, 无前缀): 定时任务管理（启动/暂停/监控）。
  
数据同步与初始化：
- /sync (sync_router.router, 无前缀): 通用数据同步。
- /multi-source-sync (multi_source_sync.router, 无前缀): 多数据源同步。
- /api/paper (paper_router.router): 模拟交易接口。
- /api/tushare-init (tushare_init.router): Tushare数据源初始化/令牌验证。
- /api/akshare-init (akshare_init.router): AKShare数据源初始化。
- /api/baostock-init (baostock_init.router): BaoStock数据源初始化。
  
数据源特定接口：
- /historical-data (historical_data.router, 无前缀): 历史数据查询/同步。
- /multi-period-sync (multi_period_sync.router, 无前缀): 多周期数据同步。
- /financial-data (financial_data.router, 无前缀): 财务数据（报表、指标）。
- /news-data (news_data.router, 无前缀): 新闻数据查询/同步。
- /social-media (social_media.router, 无前缀): 社交媒体数据（如微博、论坛）。
- /internal-messages (internal_messages.router, 无前缀): 内部消息系统。
  
其他：
- GET /: 返回API版本和状态。
- GET /api/test-log: 测试日志记录（开发用）。
  
主要差异：
1. 接口数量与复杂度：
  - 根app：仅2个简单端点（1健康 + 1分析），专注于单股AI分析，无持久化、无认证、无批量支持。
  - 参考app：超过20个模块，50+端点，支持完整后端功能，包括多数据源同步（Tushare/AKShare/BaoStock）、数据库（MongoDB/Redis）、用户系统、实时通知（WebSocket/SSE）、任务调度（APScheduler）、日志/监控。
    
2. 功能覆盖：
  - 根app：仅代理TradingAgentsGraph的分析，无数据同步或存储。
  - 参考app：集成数据源初始化/同步、股票管理、筛选、报告导出、队列处理、配置管理。分析接口（/api/analysis）更强大，支持进度跟踪、批量、多市场。
    
3. 架构：
  - 根app：单文件、无中间件、无数据库依赖。
  - 参考app：模块化（routers/services/models），支持CORS/TrustedHost、异常处理、操作日志、生命周期管理（lifespan）、定时任务。
    
4. 依赖与扩展：
  - 根app：依赖tradingagents库，直接调用Graph。
  - 参考app：独立后端，可桥接tradingagents配置，支持多LLM、多数据源，生产级（代理、监控、备份）。
    
参考app是根app的扩展版本，提供企业级股票分析平台接口，而根app更像最小化原型。
后端服务更新计划
基于参考目录（reference/TradingAgents-CN/app）的接口结构和实现，我制定了一个分批次更新计划，用于逐步完善项目根目录下的app目录（当前仅包含简单的主应用入口）。计划按模块划分，优先考虑核心功能（如分析和健康检查），然后扩展到用户管理、数据处理和系统功能。每个批次控制在3-5个接口，避免一次性改动过多，确保逐步测试和验证。

计划假设我们将逐步引入routers（类似于参考app），使用FastAPI的include_router机制。每个批次包括：
- 需要参考的参考模块/文件。
- 将添加的接口（端点路径、方法、简要描述）。
- 更新main.py的改动（e.g., 添加router导入和include_router）。
- 潜在依赖（e.g., models, services），但暂不实现细节，只规划结构。
- 预计输出：更新后的main.py骨架和新的router文件路径。
  
总批次：6个，覆盖参考app的主要模块。完成后，app将具备约80%的参考功能（排除高级如WebSocket/SSE，多数据源同步可后期扩展）。
指令
按下面接口添加计划的步骤，基于参考目录（reference/TradingAgents-CN/app）的接口结构和实现，完善项目根目录下的app目录
批次1: 基础设置和健康检查（添加2个接口，建立核心框架）
- 目标：增强main.py的安全性和监控基础，添加健康检查。参考：reference/TradingAgents-CN/app/core（config, startup_validator）、routers/health.py。
- 添加接口：
  - GET /api/health：返回应用状态（e.g., {"status": "healthy", "version": "0.1.0"}）。
  - GET /：扩展根路径，返回API信息（e.g., 版本、docs_url）。
- main.py改动：添加CORS/TrustedHost中间件（从参考复制），导入health router，include_router(health.router, prefix="/api", tags=["health"])。
- 新文件：app/routers/health.py（简单端点定义）。
- 依赖规划：app/core/config.py（从参考迁移settings），app/core/startup_validator.py（基本验证）。
- 理由：基础批次，确保应用可运行并监控。预计时间：1步，测试启动。
  
批次2: 增强分析模块（添加3个接口，扩展核心业务）
- 目标：基于现有/api/analysis，添加批量和进度跟踪。参考：routers/analysis.py、services/analysis_service.py。
- 添加接口：
  - POST /api/analysis/single：单股分析（现有接口重构为/single）。
  - POST /api/analysis/batch：批量股票分析（接收列表，返回任务ID）。
  - GET /api/analysis/{task_id}/status：查询分析进度/结果。
- main.py改动：导入analysis router，include_router(analysis.router, prefix="/api/analysis", tags=["analysis"])。
- 新文件：app/routers/analysis.py（端点）、app/services/analysis_service.py（Graph调用封装）。
- 依赖规划：app/models/analysis.py（Pydantic模型，如AnalysisRequest），集成tradingagents.graph。
- 理由：分析是根app的核心，添加批量支持提升实用性。控制在3个接口，避免队列复杂。
  
批次3: 报告和通知基础（添加3个接口，支持输出）
- 目标：添加报告生成和简单通知。参考：routers/reports.py、notifications.py、services/report_exporter.py。
- 添加接口：
  - POST /reports/generate：生成分析报告（输入task_id，返回报告路径/内容）。
  - GET /reports/{report_id}：下载报告（MD/PDF）。
  - POST /api/notifications：发送通知（e.g., 分析完成警报，简化版无WebSocket）。
- main.py改动：导入reports和notifications routers，include_router(reports.router, tags=["reports"])；include_router(notifications.router, prefix="/api", tags=["notifications"])。
- 新文件：app/routers/reports.py、app/routers/notifications.py；app/services/report_exporter.py（从现有web/utils借用）。
- 依赖规划：app/models/notification.py、app/models/analysis.py（复用）。
- 理由：与分析联动，提供完整流程。通知简化，避免实时复杂。
  
批次4: 用户认证和收藏（添加4个接口，引入用户系统）
- 目标：添加基本认证和个人化功能。参考：routers/auth_db.py、favorites.py、models/user.py。
- 添加接口：
  - POST /api/auth/login：用户登录（返回JWT）。
  - POST /api/auth/register：用户注册。
  - POST /api/favorites：添加/删除收藏股票。
  - GET /api/favorites：获取用户收藏列表。
- main.py改动：导入auth和favorites routers，include_router(auth.router, prefix="/api/auth", tags=["authentication"])；include_router(favorites.router, prefix="/api", tags=["favorites"])。添加依赖注入（e.g., Depends(OAuth2PasswordBearer)）。
- 新文件：app/routers/auth.py、app/routers/favorites.py；app/models/user.py、app/services/auth_service.py。
- 依赖规划：集成MongoDB（从参考core/database.py迁移基本init_db）。
- 理由：引入用户管理，按模块划分，便于测试认证流。
  
批次5: 股票数据和筛选（添加4个接口，数据基础）
- 目标：添加股票查询和简单筛选。参考：routers/stocks.py、screening.py、stock_data.py。
- 添加接口：
  - GET /api/stocks：股票列表查询（支持市场过滤，如A股）。
  - GET /api/stock-data/{symbol}：获取股票实时/历史数据（集成tushare）。
  - POST /api/screening：股票筛选（e.g., 条件如市值>100亿）。
  - GET /api/screening/results：筛选结果列表。
- main.py改动：导入stocks、stock_data、screening routers，相应include_router（prefix="/api", tags=["stocks", "screening"]）。
- 新文件：app/routers/stocks.py、app/routers/stock_data.py、app/routers/screening.py；app/services/stock_service.py（数据源适配）。
- 依赖规划：app/services/data_sources/tushare_adapter.py（从tradingagents/dataflows借用），app/models/stock_models.py。
- 理由：数据是分析前提，控制在4个，聚焦基本查询/筛选。
  
批次6: 系统配置和监控（添加3个接口，完成生产化）
- 目标：添加配置管理和日志/统计。参考：routers/config.py、operation_logs.py、usage_statistics.py、database.py。
- 添加接口：
  - GET /api/config：系统配置查询（e.g., LLM设置）。
  - GET /api/system/operation_logs：操作日志列表（分页）。
  - GET /usage-statistics：使用统计（e.g., API调用次数）。
- main.py改动：导入config、operation_logs、usage_statistics routers，include_router(config.router, prefix="/api", tags=["config"]) 等。添加OperationLogMiddleware（从参考迁移）。
- 新文件：app/routers/config.py、app/routers/operation_logs.py、app/routers/usage_statistics.py；app/middleware/operation_log_middleware.py。
- 依赖规划：app/core/logging_config.py、app/services/config_service.py、Redis集成（基本进度跟踪）。
- 理由：最后批次，聚焦运维。忽略高级如多数据源同步/调度（可作为扩展）。
  
总体实施建议：
- 每个批次后：使用execute_command运行uvicorn app.main:app --reload测试端点（e.g., curl /api/health），确认无错。
- 目录结构：逐步添加app/routers/、app/services/、app/models/、app/core/、app/middleware/，模仿参考。
- 跨批次依赖：批次1-2依赖tradingagents库；批次4+需数据库（先用SQLite测试，后MongoDB）。
- 完成标志：所有router集成，文档生成（/docs）。后续可并行实现services细节。
- 潜在风险：数据源集成需API密钥（.env），认证需密码哈希。
  
此计划可根据反馈调整顺序。