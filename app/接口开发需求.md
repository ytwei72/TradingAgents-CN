# 后端服务接口开发需求

## 文档说明

本文档定义了 TradingAgents 后端接口开发的标准流程和要求，用于指导 AI Agent 进行接口开发工作。

**更新时间**: 2025-12-02

---

## 1. 确定开发批次

### 1.1 选择当前批次

- 查阅 `app/接口开发计划.md`
- 找到**最早一个未全部完成开发的批次**
- 该批次作为当前计划要开发的接口批次

### 1.2 提取接口清单

从选定批次中提取所有状态为 📋 **计划中** 的接口，生成接口清单。

---

## 2. 用户确认开发范围

### 2.1 展示接口清单

向用户展示当前批次的接口清单，格式如下：

```
当前批次：批次X - [批次名称]

待开发接口清单：
1. [HTTP方法] [接口路径] - [接口功能说明]
2. [HTTP方法] [接口路径] - [接口功能说明]
...
```

### 2.2 询问用户意见

询问用户：
- 是否开发本批次的**全部接口**？
- 还是只开发**部分接口**？

### 2.3 确定开发清单

- 如果用户选择全部开发：按清单顺序全部实现
- 如果用户选择部分开发：根据用户反馈的**接口序号**，确定要实现的接口

---

## 3. 接口实现要求

### 3.1 技术框架参考

接口实现应基于当前 `app/` 目录的整体框架：

- **路由层**: `app/routers/` - 定义接口端点和参数验证
- **服务层**: `app/services/` - 实现业务逻辑（如需要）
- **数据模型**: `app/models/` 或 `app/schemas/` - 定义请求/响应模型
- **核心配置**: `app/core/` - 配置管理和启动验证
- **中间件**: `app/middleware/` - 跨切面功能（如需要）

### 3.2 参考实现

当实现细节不清晰时，可参考以下代码：

- **参考目录**: `reference/TradingAgents-CN/app/`
- **参考范围**: 
  - 路由实现模式
  - 数据模型定义
  - 异步任务处理
  - 错误处理机制
  - 响应格式标准化

**注意**: 参考代码仅供借鉴，需根据当前项目实际情况调整。

### 3.3 设计规范参考

实现接口时应遵循以下文档的规范：

- **架构设计**: `app/后端服务接口架构设计.md` - 系统架构、模块设计、数据模型
- **接口规范**: `app/后端服务接口规范.md` - 请求/响应格式、错误码、命名规范

### 3.4 Python 环境要求

在接口实现过程中，如果需要运行 Python 代码以检验模块功能，**必须使用项目虚拟环境**：

- **虚拟环境路径**: `.venv/`
- **Python 解释器**: `.venv/Scripts/python.exe` (Windows) 

**示例**：
```bash
# Windows
.venv\Scripts\python.exe -m pytest tests/
```

---

## 4. 测试要求

### 4.1 提供 cURL 测试命令

每个完成的接口必须提供可执行的 cURL 测试命令，示例：

```bash
# 示例：启动分析任务
curl -X POST http://localhost:8000/api/analysis/start \
  -H "Content-Type: application/json" \
  -d '{
    "stock_symbol": "AAPL",
    "market_type": "美股",
    "analysts": ["market_analyst"],
    "research_depth": 3
  }'
```

### 4.2 Postman 兼容性

- cURL 命令应能直接导入到 Postman
- 使用标准的 HTTP 方法和 JSON 格式
- 包含必要的请求头（Content-Type 等）

### 4.3 测试覆盖

提供的测试命令应覆盖：
- ✅ 正常请求场景
- ✅ 必填参数验证
- ⚠️ 可选参数示例（如适用）

---

## 5. 文档更新流程

### 5.1 完成接口开发后

完成相关接口的代码编写后，**询问用户**是否需要更新以下技术文档：

1. **后端服务接口架构设计.md** - 如有新增模块、服务或架构变更
2. **后端服务接口规范.md** - 添加新接口的详细规范
3. **接口开发计划.md** - 更新接口完成状态

### 5.2 文档更新标记

在更新的技术文档中，应在**新增或修改的接口章节**标注草稿状态：

```markdown
### X.X 接口名称

**状态**: 🚧 草稿

接口描述和规范内容...
```

### 5.3 更新内容要求

- 保持与实际代码实现一致
- 使用清晰的示例和说明
- 遵循现有文档的格式和风格
- 标注新增或修改的部分

---

## 6. 其他要求

### 6.1 文档生成限制

在任务进行中及完成时，**不要生成**以下文档：
- `final walkthrough documentation` (或类似的 walkthrough 文档)

请专注于代码实现和技术文档（架构设计、接口规范）的更新。

---

## 附录：相关文档索引

| 文档名称 | 路径 | 用途 |
|---------|------|------|
| 接口开发计划 | `app/接口开发计划.md` | 查看开发批次和接口清单 |
| 后端服务接口架构设计 | `app/后端服务接口架构设计.md` | 了解系统架构和设计规范 |
| 后端服务接口规范 | `app/后端服务接口规范.md` | 查看接口规范和示例 |
| 参考实现代码 | `reference/TradingAgents-CN/app/` | 参考具体实现细节 |

---

