# 新闻数据源迁移 - 快速索引

## 🎯 目的

本文档集提供了从旧版新闻数据源迁移到新版 `news_engine` 的完整解决方案。

## 📚 文档导航

### 🚀 快速开始（5分钟）

**推荐阅读顺序**:

1️⃣ **先看这个** → [工作总结](./MIGRATION_SUMMARY.md)  
   - 快速了解整体情况
   - 核心发现和建议
   - 5分钟读完

2️⃣ **然后看这个** → [迁移指南](./migration_guide.md)  
   - 实施步骤
   - 测试方法
   - 10分钟读完

3️⃣ **需要细节时** → [评估报告](./news_engine_migration_evaluation.md)  
   - 详细技术分析
   - 完整对比表
   - 30分钟深度阅读

---

## 📋 文档清单

### 核心文档

| 文档 | 适合人群 | 阅读时长 | 优先级 |
|------|---------|---------|--------|
| [**工作总结**](./MIGRATION_SUMMARY.md) | 所有人 | 5分钟 | 🔴 必读 |
| [**迁移指南**](./migration_guide.md) | 开发/运维 | 10分钟 | 🔴 必读 |
| [**评估报告**](./news_engine_migration_evaluation.md) | 技术决策者 | 30分钟 | 🟡 推荐 |

### 代码文件

| 文件 | 说明 | 类型 |
|------|------|------|
| [`unified_news_tool_v2_draft.py`](../../tradingagents/tools/unified_news_tool_v2_draft.py) | V2实现草稿 | 生产代码 |
| [`test_news_migration.py`](../../scripts/test_news_migration.py) | 迁移测试脚本 | 测试工具 |

### 相关文档

| 文档 | 说明 |
|------|------|
| [新闻功能定义](./news_func_def.md) | 新闻分析师接口文档 |
| [新闻模块架构设计](./新闻模块架构设计.md) | news_engine架构说明 |
| [Tushare限制说明](../tushare_news_api_limitations.md) | API限制文档 |

---

## 🎬 快速测试

### 5分钟测试
```bash
# 1. 测试单个股票
python scripts/test_news_migration.py --stock 000002

# 2. 查看结果对比
# 输出会显示新旧版本的性能对比
```

### 15分钟完整测试
```bash
# 批量测试多个股票
python scripts/test_news_migration.py --batch

# 测试覆盖：
# - A股: 000002, 600000
# - 港股: 0700.HK
# - 美股: AAPL
```

---

## 🔍 核心问题快速查找

### "我应该切换吗？"
👉 查看：[评估报告 - 总结与建议](./news_engine_migration_evaluation.md#✅-总结与建议)  
**简答**: 推荐使用混合模式，风险最低

### "怎么切换？"
👉 查看：[迁移指南 - 实施步骤](./migration_guide.md#🔧-实施步骤)  
**简答**: 4个阶段，预计1-2周完成

### "风险有多大？"
👉 查看：[评估报告 - 切换风险评估](./news_engine_migration_evaluation.md#⚠️-切换风险评估)  
**简答**: 中等风险，但可控，有完整回滚方案

### "新版有什么好处？"
👉 查看：[评估报告 - 功能特性对比](./news_engine_migration_evaluation.md#📊-旧版数据源-vs-新版-news_engine-对比)  
**简答**: 
- ✅ 重试机制更完善
- ✅ 架构更清晰
- ✅ 配置更灵活

### "会不会出问题？"
👉 查看：[迁移指南 - 回滚方案](./migration_guide.md#🔙-回滚方案)  
**简答**: 有完整的回滚方案，可5分钟内回退

### "怎么监控？"
👉 查看：[迁移指南 - 监控与告警](./migration_guide.md#📊-监控与告警)  
**简答**: 提供了详细的监控指标和告警规则

---

## 🎯 不同角色的阅读建议

### 技术决策者
**目标**: 决定是否切换

📖 **阅读顺序**:
1. [工作总结](./MIGRATION_SUMMARY.md) - 了解整体情况
2. [评估报告 - 核心差异](./news_engine_migration_evaluation.md#🎯-核心差异总结) - 技术对比
3. [评估报告 - 总结建议](./news_engine_migration_evaluation.md#✅-总结与建议) - 决策依据

⏱️ **时间**: 20分钟

### 开发人员
**目标**: 实施迁移

📖 **阅读顺序**:
1. [工作总结](./MIGRATION_SUMMARY.md) - 快速了解
2. [迁移指南 - 实施步骤](./migration_guide.md#🔧-实施步骤) - 详细步骤
3. [V2实现代码](../../tradingagents/tools/unified_news_tool_v2_draft.py) - 实现参考

⏱️ **时间**: 30分钟 + 编码时间

### 测试人员
**目标**: 验证功能

📖 **阅读顺序**:
1. [迁移指南 - 测试阶段](./migration_guide.md#phase-3-测试阶段2-3天) - 测试要求
2. [测试脚本](../../scripts/test_news_migration.py) - 测试工具
3. [评估报告 - 监控指标](./news_engine_migration_evaluation.md#📈-监控指标) - 验收标准

⏱️ **时间**: 15分钟 + 测试时间

### 运维人员
**目标**: 上线和监控

📖 **阅读顺序**:
1. [迁移指南 - 灰度发布](./migration_guide.md#phase-4-灰度发布1-2周) - 发布策略
2. [迁移指南 - 监控告警](./migration_guide.md#📊-监控与告警) - 监控配置
3. [迁移指南 - 回滚方案](./migration_guide.md#🔙-回滚方案) - 应急处理

⏱️ **时间**: 20分钟

---

## 💡 核心要点（TL;DR）

### 当前状态
- ❌ 新闻分析师**未使用**news_engine
- ✅ 使用`unified_news_tool.py`调用旧版数据源
- ⚠️ 旧版依赖Google、OpenAI等通用新闻源

### 主要差异
| 维度 | 旧版 | 新版 |
|------|------|------|
| 数据源数量 | 8+ | 4 |
| 数据源类型 | 通用+专业 | 纯专业 |
| 错误处理 | 简单 | 完善（重试） |
| 架构 | 分散 | 模块化 |

### 推荐方案
🎯 **混合模式**：优先news_engine，降级到旧版

理由：
- ✅ 风险最低
- ✅ 成功率最高
- ✅ 可逐步优化

### 预期效果
- 📈 成功率: 90% → 95%+
- ⚡ 响应时间: 4秒 → 3秒
- 🔄 错误恢复: +50%
- 🏗️ 可维护性: +30%

### 实施时间
- **准备**: 1-2天
- **开发**: 3-5天
- **测试**: 2-3天
- **灰度**: 1-2周
- **总计**: 约2-3周

### 风险等级
🟡 **中等风险** - 可控，有完整回滚方案

### 关键成功因素
1. ✅ 充分的测试
2. ✅ 完善的监控
3. ✅ 快速回滚能力
4. ✅ 灰度发布策略

---

## 🚦 决策流程

```
开始
  ↓
是否需要更高的可靠性？
  ↓ 是
是否愿意配置专业数据源API？
  ↓ 是
是否接受2-3周的迁移时间？
  ↓ 是
  → 推荐迁移！使用混合模式
  
  ↓ 否（任一环节）
  → 保持现状，或等待更好时机
```

---

## 📞 获取帮助

### 遇到问题？

1. **先查文档**
   - 大部分问题都有答案
   - 使用Ctrl+F快速搜索

2. **运行测试**
   ```bash
   python scripts/test_news_migration.py --batch
   ```

3. **查看日志**
   ```bash
   tail -f logs/tradingagents.log | grep "新闻"
   ```

4. **联系支持**
   - 📧 Email: support@example.com
   - 💬 Slack: #trading-agents-news
   - 📝 GitHub Issues

---

## 🔄 文档更新

### 版本历史
- **v1.0** (2025-11-26): 初始版本

### 下次审查
📅 **2026-02-26** - 3个月后审查更新

### 维护者
👤 AI Assistant

---

## ⭐ 快速行动建议

### 本周内
1. ⏰ 10分钟：阅读工作总结
2. ⏰ 5分钟：运行快速测试
3. ⏰ 5分钟：做出决策

### 下周开始
1. 按照迁移指南准备环境
2. 开发混合模式实现
3. 开始测试

### 一个月内
1. 完成灰度发布
2. 建立监控体系
3. 优化策略

---

## 🎉 V2 已启用！

**✅ 新闻分析师节点已切换到 V2 版本**

- 📅 切换日期: 2025-11-26
- 🎯 当前版本: V2 混合模式（默认）
- 📦 备选版本: V1 旧版逻辑（保留）
- 🔧 切换方式: 环境变量 `USE_NEWS_TOOL_V2`

### 快速操作

```bash
# 查看当前版本
tail -f logs/tradingagents.log | grep "新闻分析师"

# 切换到V1（回滚）
export USE_NEWS_TOOL_V2=false && 重启服务

# 切换回V2
export USE_NEWS_TOOL_V2=true && 重启服务
```

详细说明 → [V2切换指南](./V2_SWITCH_GUIDE.md) 🎯

---

**开始行动** → [查看工作总结](./MIGRATION_SUMMARY.md) 📖

