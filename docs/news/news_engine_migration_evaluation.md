# æ–°é—»åˆ†æå¸ˆèŠ‚ç‚¹ - æ–°é—»æ•°æ®æºåˆ‡æ¢è¯„ä¼°æŠ¥å‘Š

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯„ä¼°æ–°é—»åˆ†æå¸ˆèŠ‚ç‚¹ä»æ—§ç‰ˆæ–°é—»æ•°æ®æºï¼ˆ`RealtimeNewsAggregator`ï¼‰åˆ‡æ¢åˆ°æ–°ç‰ˆ `news_engine` æ¨¡å—çš„æƒ…å†µã€‚

**è¯„ä¼°æ—¥æœŸ**: 2025-11-26  
**è¯„ä¼°èŒƒå›´**: æ–°é—»åˆ†æå¸ˆèŠ‚ç‚¹ (`tradingagents/agents/analysts/news_analyst.py`)  
**æ ¸å¿ƒé—®é¢˜**: è¯„ä¼°å½“å‰ä½¿ç”¨çš„æ–°é—»è·å–æ–¹å¼ä¸æ–°ç‰ˆnews_engineçš„å·®å¼‚

---

## ğŸ” å½“å‰çŠ¶æ€åˆ†æ

### 1. æ–°é—»åˆ†æå¸ˆèŠ‚ç‚¹ä½¿ç”¨çš„æ•°æ®æº

**å½“å‰å®ç°**: `tradingagents/agents/analysts/news_analyst.py`

æ–°é—»åˆ†æå¸ˆèŠ‚ç‚¹**å¹¶æœªç›´æ¥ä½¿ç”¨** `news_engine` æ¨¡å—ï¼Œè€Œæ˜¯é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–æ–°é—»ï¼š

#### ä¸»è¦æ¥å£
```python
# ä½¿ç”¨ç»Ÿä¸€æ–°é—»å·¥å…·
from tradingagents.tools.unified_news_tool import create_unified_news_tool

unified_news_tool = create_unified_news_tool(toolkit)
```

#### è°ƒç”¨é“¾è·¯
```
news_analyst.py
  â””â”€> unified_news_tool.py (ç»Ÿä¸€æ–°é—»å·¥å…·)
       â”œâ”€> toolkit.get_realtime_stock_news (ä¸œæ–¹è´¢å¯Œæ–°é—» - Aè‚¡ä¼˜å…ˆ)
       â”œâ”€> toolkit.get_google_news (Googleæ–°é—»)
       â””â”€> toolkit.get_global_news_openai (OpenAIå…¨çƒæ–°é—»)
```

---

## ğŸ“Š æ—§ç‰ˆæ•°æ®æº vs æ–°ç‰ˆ news_engine å¯¹æ¯”

### æ¶æ„å¯¹æ¯”

| ç»´åº¦ | æ—§ç‰ˆæ•°æ®æº (å½“å‰ä½¿ç”¨) | æ–°ç‰ˆ news_engine |
|------|---------------------|------------------|
| **æ ¸å¿ƒæ¨¡å—** | `RealtimeNewsAggregator`<br>(`tradingagents/dataflows/realtime_news_utils.py`) | `NewsAggregator`<br>(`tradingagents/news_engine/aggregator.py`) |
| **è°ƒç”¨æ–¹å¼** | é€šè¿‡ `unified_news_tool` é—´æ¥è°ƒç”¨ | ç›´æ¥å¯¼å…¥ä½¿ç”¨ |
| **æ¶æ„æ¨¡å¼** | åˆ†æ•£å¼ï¼Œä¾èµ–å¤šä¸ªå·¥å…·å‡½æ•° | æ¨¡å—åŒ–ï¼Œç»Ÿä¸€èšåˆå™¨ |
| **é…ç½®ç®¡ç†** | ç¡¬ç¼–ç åœ¨ä»£ç ä¸­ | é›†ä¸­å¼é…ç½® (`news_engine/config.py`) |
| **æ•°æ®æºæŠ½è±¡** | å‡½æ•°çº§åˆ« | Provider æŠ½è±¡ç±» |
| **é”™è¯¯å¤„ç†** | ç®€å•çš„ try-except | é‡è¯•æœºåˆ¶ + æŒ‡æ•°é€€é¿ |

---

### æ•°æ®æºæ”¯æŒå¯¹æ¯”

#### Aè‚¡æ–°é—»

| æ•°æ®æº | æ—§ç‰ˆæ”¯æŒ | æ–°ç‰ˆæ”¯æŒ | ä¼˜å…ˆçº§ |
|--------|---------|---------|--------|
| **ä¸œæ–¹è´¢å¯Œ (AKShare)** | âœ… ä¼˜å…ˆçº§1 | âœ… | é«˜ |
| **Tushare** | âœ… ä½œä¸ºå¤‡é€‰ | âœ… | ä¸­ |
| **Googleæ–°é—»** | âœ… å¤‡é€‰ | âŒ | - |
| **OpenAIæ–°é—»** | âœ… å¤‡é€‰ | âŒ | - |

**è¯„ä¼°**: 
- âœ… æ–°ç‰ˆä¿ç•™äº†æ ¸å¿ƒAè‚¡æ•°æ®æº
- âš ï¸ æ–°ç‰ˆç§»é™¤äº†Googleå’ŒOpenAIä½œä¸ºAè‚¡å¤‡é€‰æº

#### æ¸¯è‚¡æ–°é—»

| æ•°æ®æº | æ—§ç‰ˆæ”¯æŒ | æ–°ç‰ˆæ”¯æŒ | ä¼˜å…ˆçº§ |
|--------|---------|---------|--------|
| **EODHD** | âœ… | âœ… ä¼˜å…ˆçº§1 | é«˜ |
| **FinnHub** | âœ… | âœ… ä¼˜å…ˆçº§2 | ä¸­ |
| **Googleæ–°é—»** | âœ… ä¼˜å…ˆ | âŒ | - |
| **ä¸œæ–¹è´¢å¯Œ** | âœ… å¤‡é€‰ | âŒ | - |

**è¯„ä¼°**:
- âœ… æ–°ç‰ˆå¢å¼ºäº†ä¸“ä¸šæ¸¯è‚¡æ•°æ®æºï¼ˆEODHDï¼‰
- âš ï¸ ç§»é™¤äº†Googleæ–°é—»ä½œä¸ºæ¸¯è‚¡é¦–é€‰

#### ç¾è‚¡æ–°é—»

| æ•°æ®æº | æ—§ç‰ˆæ”¯æŒ | æ–°ç‰ˆæ”¯æŒ | ä¼˜å…ˆçº§ |
|--------|---------|---------|--------|
| **FinnHub** | âœ… ä¼˜å…ˆçº§1 | âœ… ä¼˜å…ˆçº§1 | é«˜ |
| **EODHD** | âœ… | âœ… ä¼˜å…ˆçº§2 | ä¸­ |
| **OpenAIå…¨çƒæ–°é—»** | âœ… ä¼˜å…ˆ | âŒ | - |
| **Googleæ–°é—»** | âœ… å¤‡é€‰ | âŒ | - |
| **Alpha Vantage** | âœ… | âŒ | - |
| **NewsAPI** | âœ… | âŒ | - |

**è¯„ä¼°**:
- âœ… ä¿ç•™æ ¸å¿ƒä¸“ä¸šæ•°æ®æºï¼ˆFinnHubã€EODHDï¼‰
- âš ï¸ ç§»é™¤äº†å¤šä¸ªå¤‡é€‰æ–°é—»æº

---

### åŠŸèƒ½ç‰¹æ€§å¯¹æ¯”

#### 1. æ–°é—»è·å–

| ç‰¹æ€§ | æ—§ç‰ˆ | æ–°ç‰ˆ | è¯„ä»· |
|------|------|------|------|
| **æ—¶é—´èŒƒå›´è¿‡æ»¤** | âœ… æ”¯æŒ hours_back | âœ… æ”¯æŒ hours_back | ä¸€è‡´ |
| **æ—¥æœŸæŒ‡å®š** | âœ… curr_date å‚æ•° | âœ… start_date/end_date | æ–°ç‰ˆæ›´çµæ´» |
| **æ•°é‡é™åˆ¶** | âœ… max_news | âœ… max_news | ä¸€è‡´ |
| **è‡ªåŠ¨è‚¡ç¥¨ç±»å‹è¯†åˆ«** | âœ… | âœ… | ä¸€è‡´ |
| **ç›¸å…³æ€§è¯„åˆ†** | âœ… | âœ… | ä¸€è‡´ |
| **ç´§æ€¥ç¨‹åº¦è¯„ä¼°** | âœ… | âœ… | ä¸€è‡´ |

#### 2. æ•°æ®å¤„ç†

| ç‰¹æ€§ | æ—§ç‰ˆ | æ–°ç‰ˆ | è¯„ä»· |
|------|------|------|------|
| **å»é‡** | âœ… åŸºäºæ ‡é¢˜ | âœ… åŸºäºæ ‡é¢˜ | ä¸€è‡´ |
| **æ—¶æ•ˆæ€§æ£€æŸ¥** | âœ… | âœ… | ä¸€è‡´ |
| **ç›¸å…³æ€§è¿‡æ»¤** | âœ… ç¡¬ç¼–ç é˜ˆå€¼ | âœ… å¯é…ç½®é˜ˆå€¼ | æ–°ç‰ˆæ›´çµæ´» |
| **æ—¶é—´æ’åº** | âœ… | âœ… | ä¸€è‡´ |
| **å†…å®¹æ ¼å¼åŒ–** | âœ… | âœ… | ä¸€è‡´ |

#### 3. é”™è¯¯å¤„ç†

| ç‰¹æ€§ | æ—§ç‰ˆ | æ–°ç‰ˆ | è¯„ä»· |
|------|------|------|------|
| **å¼‚å¸¸æ•è·** | âœ… ç®€å• try-except | âœ… è¯¦ç»†é”™è¯¯åˆ†ç±» | æ–°ç‰ˆæ›´å®Œå–„ |
| **é‡è¯•æœºåˆ¶** | âŒ æ—  | âœ… æŒ‡æ•°é€€é¿é‡è¯• | æ–°ç‰ˆæ˜¾è‘—å¢å¼º |
| **é™çº§ç­–ç•¥** | âœ… å¤šçº§å¤‡é€‰æº | âœ… ä¼˜å…ˆçº§è‡ªåŠ¨åˆ‡æ¢ | æ–°ç‰ˆæ›´ç³»ç»ŸåŒ– |
| **è¶…æ—¶å¤„ç†** | âŒ æ— ä¸“é—¨å¤„ç† | âœ… é…ç½®åŒ–è¶…æ—¶ | æ–°ç‰ˆæ›´å¥å£® |

#### 4. é…ç½®ç®¡ç†

| ç‰¹æ€§ | æ—§ç‰ˆ | æ–°ç‰ˆ | è¯„ä»· |
|------|------|------|------|
| **APIå¯†é’¥ç®¡ç†** | âœ… ç¯å¢ƒå˜é‡ | âœ… ç¯å¢ƒå˜é‡ | ä¸€è‡´ |
| **å‚æ•°é…ç½®** | âŒ ç¡¬ç¼–ç  | âœ… é›†ä¸­é…ç½®æ–‡ä»¶ | æ–°ç‰ˆæ›´æ˜“ç»´æŠ¤ |
| **æ•°æ®æºä¼˜å…ˆçº§** | âŒ ä»£ç å›ºå®š | âœ… å¯é…ç½® | æ–°ç‰ˆæ›´çµæ´» |
| **é‡è¯•ç­–ç•¥** | âŒ æ—  | âœ… å¯é…ç½® | æ–°ç‰ˆæ›´å¼ºå¤§ |

---

## ğŸ¯ æ ¸å¿ƒå·®å¼‚æ€»ç»“

### 1. æ¶æ„è®¾è®¡

**æ—§ç‰ˆï¼ˆå½“å‰ï¼‰**:
```python
# åˆ†æ•£å¼æ¶æ„
ç»Ÿä¸€æ–°é—»å·¥å…·
  â””â”€> å¤šä¸ªç‹¬ç«‹å·¥å…·å‡½æ•°
       â”œâ”€> get_realtime_stock_news (ä¸œæ–¹è´¢å¯Œ)
       â”œâ”€> get_google_news (Google)
       â””â”€> get_global_news_openai (OpenAI)

# ç‰¹ç‚¹:
# - çµæ´»æ€§é«˜ï¼Œå¯ä»¥æ ¹æ®éœ€è¦ç»„åˆä¸åŒæ•°æ®æº
# - ä¾èµ– toolkit ä¼ é€’å·¥å…·å‡½æ•°
# - æ”¯æŒæ›´å¤šå¤‡é€‰æ–°é—»æºï¼ˆGoogleã€OpenAIï¼‰
```

**æ–°ç‰ˆï¼ˆnews_engineï¼‰**:
```python
# æ¨¡å—åŒ–æ¶æ„
NewsAggregator
  â””â”€> Provideræ¥å£
       â”œâ”€> TushareNewsProvider
       â”œâ”€> AKShareNewsProvider
       â”œâ”€> FinnhubNewsProvider
       â””â”€> EODHDNewsProvider

# ç‰¹ç‚¹:
# - æ¶æ„æ›´æ¸…æ™°ï¼Œæ¨¡å—è¾¹ç•Œæ˜ç¡®
# - Provider æŠ½è±¡ç»Ÿä¸€æ¥å£
# - ä¸“æ³¨äºä¸“ä¸šé‡‘èæ•°æ®æº
# - é‡è¯•å’Œé”™è¯¯å¤„ç†æ›´å®Œå–„
```

### 2. æ•°æ®æºç­–ç•¥

**æ—§ç‰ˆä¼˜åŠ¿**:
- âœ… æ›´å¤šå¤‡é€‰æ•°æ®æºï¼ˆGoogleã€OpenAIã€NewsAPIã€Alpha Vantageç­‰ï¼‰
- âœ… å¯¹äºæ— ä¸“ä¸šAPI keyçš„åœºæ™¯ï¼Œå¯é™çº§åˆ°Googleæ–°é—»
- âœ… æ›´çµæ´»çš„æ•°æ®æºç»„åˆ

**æ–°ç‰ˆä¼˜åŠ¿**:
- âœ… ä¸“æ³¨äºä¸“ä¸šé‡‘èæ•°æ®æºï¼ˆè´¨é‡æ›´é«˜ï¼‰
- âœ… æ•°æ®æºä¼˜å…ˆçº§æ›´æ˜ç¡®
- âœ… ç»Ÿä¸€çš„Provideræ¥å£ä¾¿äºæ‰©å±•

### 3. å¯é æ€§å¯¹æ¯”

| ç»´åº¦ | æ—§ç‰ˆ | æ–°ç‰ˆ | ä¼˜åŠ¿æ–¹ |
|------|------|------|--------|
| **é‡è¯•æœºåˆ¶** | âŒ æ—  | âœ… æŒ‡æ•°é€€é¿ | æ–°ç‰ˆ |
| **é”™è¯¯åˆ†ç±»** | âŒ ç®€å• | âœ… è¯¦ç»† | æ–°ç‰ˆ |
| **é™çº§ç­–ç•¥** | âœ… å¤šæºå¤‡é€‰ | âœ… ä¼˜å…ˆçº§åˆ‡æ¢ | æŒå¹³ |
| **æ•°æ®æºå¤šæ ·æ€§** | âœ… æ›´å¤š | âŒ è¾ƒå°‘ | æ—§ç‰ˆ |

---

## âš ï¸ åˆ‡æ¢é£é™©è¯„ä¼°

### é«˜é£é™©ç‚¹

#### 1. æ•°æ®æºå‡å°‘
**é£é™©**: æ–°ç‰ˆç§»é™¤äº† Googleã€OpenAIã€NewsAPI ç­‰å¤‡é€‰æº

**å½±å“**:
- Aè‚¡ï¼šä¾èµ–ä¸œæ–¹è´¢å¯Œï¼ˆAKShareï¼‰å’ŒTushareï¼Œå¦‚æœä¸¤è€…éƒ½å¤±è´¥ï¼Œæ— æ›´å¤šå¤‡é€‰
- æ¸¯è‚¡ï¼šä¾èµ–EODHDå’ŒFinnHubï¼ŒGoogleæ–°é—»ä¸å†ä½œä¸ºå¤‡é€‰
- ç¾è‚¡ï¼šç§»é™¤äº†Alpha Vantageã€NewsAPIç­‰é¢å¤–ä¿éšœ

**ç¼“è§£æªæ–½**:
- âœ… æ–°ç‰ˆçš„é‡è¯•æœºåˆ¶å¯æé«˜å•ä¸€æ•°æ®æºæˆåŠŸç‡
- âš ï¸ ä½†ä»éœ€ç›‘æ§æ•°æ®æºå¯ç”¨æ€§

#### 2. æ¥å£ä¸å…¼å®¹
**é£é™©**: æ–°ç‰ˆ `NewsAggregator` ä¸æ—§ç‰ˆ `RealtimeNewsAggregator` æ¥å£ä¸å®Œå…¨å…¼å®¹

**å·®å¼‚ç‚¹**:
```python
# æ—§ç‰ˆæ¥å£
def get_realtime_stock_news(
    ticker: str, 
    hours_back: int = 6,
    max_news: int = 10, 
    curr_date: str = None
) -> List[NewsItem]  # è¿”å›æ–°é—»åˆ—è¡¨

# æ–°ç‰ˆæ¥å£
def get_news(
    stock_code: str,
    start_date: Optional[str] = None,
    end_date: Optional[str] = None,
    max_news: int = None,
    hours_back: int = None,
    sources: Optional[List[NewsSource]] = None,
    min_relevance: float = None
) -> NewsResponse  # è¿”å›NewsResponseå¯¹è±¡
```

**å½±å“**:
- éœ€è¦ä¿®æ”¹ `unified_news_tool.py` ä»¥é€‚é…æ–°æ¥å£
- è¿”å›æ ¼å¼ä» `List[NewsItem]` å˜ä¸º `NewsResponse` å¯¹è±¡
- æ ¼å¼åŒ–é€»è¾‘éœ€è¦è°ƒæ•´

#### 3. ä¾èµ– toolkit çš„å·¥å…·å‡½æ•°ä¸å¯ç”¨
**é£é™©**: æ–°ç‰ˆä¸æ”¯æŒé€šè¿‡ toolkit ä¼ é€’çš„ Googleã€OpenAI å·¥å…·

**å½±å“**:
- `unified_news_tool.py` ä¸­çš„å¤‡é€‰é€»è¾‘å¤±æ•ˆ
- æ— æ³•ä½¿ç”¨ `toolkit.get_google_news`
- æ— æ³•ä½¿ç”¨ `toolkit.get_global_news_openai`

**ç¼“è§£æªæ–½**:
- éœ€è¦åœ¨ news_engine ä¸­å®ç°å¯¹åº”çš„ Provider
- æˆ–è€…ä¿æŒæ—§ç‰ˆä½œä¸ºå¤‡é€‰è·¯å¾„

### ä¸­é£é™©ç‚¹

#### 1. é…ç½®å¤æ‚åº¦å¢åŠ 
**é£é™©**: æ–°ç‰ˆéœ€è¦é…ç½®å¤šä¸ª Provider çš„ API key

**å½±å“**:
- éœ€è¦é…ç½® Tushare token
- éœ€è¦é…ç½® FinnHub API key
- éœ€è¦é…ç½® EODHD API token
- é…ç½®ä¸å½“ä¼šå¯¼è‡´æ•°æ®æºä¸å¯ç”¨

#### 2. æ—¥å¿—å’Œç›‘æ§é€‚é…
**é£é™©**: æ–°ç‰ˆçš„æ—¥å¿—æ ¼å¼å’Œæ—§ç‰ˆä¸åŒ

**å½±å“**:
- ç°æœ‰çš„æ—¥å¿—åˆ†æè„šæœ¬å¯èƒ½éœ€è¦è°ƒæ•´
- ç›‘æ§å‘Šè­¦è§„åˆ™éœ€è¦æ›´æ–°

### ä½é£é™©ç‚¹

#### 1. æ•°æ®ç»“æ„å˜åŒ–
**é£é™©**: NewsItem ç»“æ„ç•¥æœ‰å·®å¼‚

**å½±å“**: è½»å¾®ï¼Œä¸»è¦å­—æ®µä¿æŒä¸€è‡´

#### 2. æ€§èƒ½å·®å¼‚
**é£é™©**: æ–°ç‰ˆé‡è¯•æœºåˆ¶å¯èƒ½å¢åŠ å»¶è¿Ÿ

**å½±å“**: åœ¨ç½‘ç»œå¼‚å¸¸æ—¶ï¼Œé‡è¯•ä¼šå¢åŠ å“åº”æ—¶é—´ï¼Œä½†æé«˜äº†æˆåŠŸç‡

---

## ğŸ’¡ åˆ‡æ¢å»ºè®®

### å»ºè®® 1: æ¸è¿›å¼è¿ç§» â­â­â­â­â­ ï¼ˆæ¨èï¼‰

**ç­–ç•¥**: ä¿æŒæ—§ç‰ˆä½œä¸ºå¤‡é€‰ï¼Œä¼˜å…ˆå°è¯•æ–°ç‰ˆ

**å®æ–½æ–¹æ¡ˆ**:
```python
# ä¿®æ”¹ unified_news_tool.py
class UnifiedNewsAnalyzer:
    def get_stock_news_unified(self, stock_code: str, ...) -> str:
        # 1. ä¼˜å…ˆå°è¯•æ–°ç‰ˆ news_engine
        try:
            from tradingagents.news_engine import get_stock_news
            response = get_stock_news(
                stock_code=stock_code,
                max_news=max_news,
                hours_back=6
            )
            if response.success and response.news_items:
                return self._format_news_engine_response(response)
        except Exception as e:
            logger.warning(f"news_engine è·å–å¤±è´¥: {e}ï¼Œå›é€€åˆ°æ—§ç‰ˆ")
        
        # 2. å›é€€åˆ°æ—§ç‰ˆé€»è¾‘ï¼ˆå½“å‰å®ç°ï¼‰
        return self._get_a_share_news_old(stock_code, max_news, ...)
```

**ä¼˜ç‚¹**:
- âœ… é£é™©æœ€ä½ï¼Œä¿ç•™æ‰€æœ‰å¤‡é€‰è·¯å¾„
- âœ… å¯ä»¥é€æ­¥éªŒè¯æ–°ç‰ˆç¨³å®šæ€§
- âœ… ç”¨æˆ·ä½“éªŒæ— å½±å“

**ç¼ºç‚¹**:
- âš ï¸ ä»£ç ç»´æŠ¤æˆæœ¬å¢åŠ 
- âš ï¸ éœ€è¦ç»´æŠ¤ä¸¤å¥—é€»è¾‘

**å®æ–½éš¾åº¦**: â­â­ (ä¸­ç­‰)

---

### å»ºè®® 2: å®Œå…¨åˆ‡æ¢åˆ° news_engine â­â­â­

**ç­–ç•¥**: å½»åº•æ›¿æ¢ä¸ºæ–°ç‰ˆ news_engine

**å®æ–½æ–¹æ¡ˆ**:
```python
# ä¿®æ”¹ unified_news_tool.pyï¼Œå®Œå…¨ä½¿ç”¨ news_engine
from tradingagents.news_engine import get_stock_news

class UnifiedNewsAnalyzer:
    def get_stock_news_unified(self, stock_code: str, ...) -> str:
        response = get_stock_news(
            stock_code=stock_code,
            max_news=max_news,
            hours_back=6
        )
        return self._format_news_engine_response(response)
```

**ä¼˜ç‚¹**:
- âœ… ä»£ç æ›´ç®€æ´
- âœ… æ¶æ„æ›´æ¸…æ™°
- âœ… åˆ©ç”¨æ–°ç‰ˆçš„é‡è¯•å’Œé”™è¯¯å¤„ç†æœºåˆ¶

**ç¼ºç‚¹**:
- âŒ å¤‡é€‰æ•°æ®æºå‡å°‘
- âŒ éœ€è¦å……åˆ†æµ‹è¯•éªŒè¯
- âš ï¸ å¯èƒ½å½±å“éƒ¨åˆ†åœºæ™¯çš„æ–°é—»è·å–æˆåŠŸç‡

**å®æ–½éš¾åº¦**: â­â­â­â­ (è¾ƒé«˜)

---

### å»ºè®® 3: æ··åˆæ¨¡å¼ï¼ˆæœ€ä¼˜æ–¹æ¡ˆï¼‰â­â­â­â­â­

**ç­–ç•¥**: ä¸ºä¸åŒå¸‚åœºä½¿ç”¨ä¸åŒç­–ç•¥

**å®æ–½æ–¹æ¡ˆ**:
```python
class UnifiedNewsAnalyzer:
    def get_stock_news_unified(self, stock_code: str, ...) -> str:
        stock_type = self._identify_stock_type(stock_code)
        
        # Aè‚¡ï¼šä¼˜å…ˆæ–°ç‰ˆï¼ˆä¸“ä¸šæºè´¨é‡é«˜ï¼‰
        if stock_type == "Aè‚¡":
            return self._get_news_via_engine(stock_code, ...)
        
        # æ¸¯è‚¡ï¼šæ–°ç‰ˆï¼ˆEODHD + FinnHubï¼‰
        elif stock_type == "æ¸¯è‚¡":
            return self._get_news_via_engine(stock_code, ...)
        
        # ç¾è‚¡ï¼šæ··åˆæ¨¡å¼ï¼ˆæ–°ç‰ˆ + æ—§ç‰ˆGoogle/OpenAIå¤‡é€‰ï¼‰
        elif stock_type == "ç¾è‚¡":
            result = self._try_news_engine(stock_code, ...)
            if not result or len(result) < 100:
                # é™çº§åˆ° Google/OpenAI
                return self._get_us_share_news_old(stock_code, ...)
            return result
        
        return self._get_news_via_engine(stock_code, ...)
```

**ä¼˜ç‚¹**:
- âœ… ç»“åˆä¸¤è€…ä¼˜åŠ¿
- âœ… é’ˆå¯¹ä¸åŒå¸‚åœºä¼˜åŒ–
- âœ… æœ€å¤§åŒ–æ•°æ®è·å–æˆåŠŸç‡

**ç¼ºç‚¹**:
- âš ï¸ å®ç°é€»è¾‘è¾ƒå¤æ‚
- âš ï¸ éœ€è¦ç»´æŠ¤ä¸¤å¥—ä»£ç è·¯å¾„

**å®æ–½éš¾åº¦**: â­â­â­ (ä¸­é«˜)

---

## ğŸ“ å®æ–½è®¡åˆ’

### Phase 1: å‡†å¤‡é˜¶æ®µï¼ˆ1-2å¤©ï¼‰

#### ä»»åŠ¡æ¸…å•
- [ ] å®Œæ•´æµ‹è¯• news_engine å„ä¸ª Provider çš„å¯ç”¨æ€§
  - [ ] æµ‹è¯• AKShareNewsProvider (Aè‚¡)
  - [ ] æµ‹è¯• TushareNewsProvider (Aè‚¡)
  - [ ] æµ‹è¯• FinnhubNewsProvider (ç¾è‚¡/æ¸¯è‚¡)
  - [ ] æµ‹è¯• EODHDNewsProvider (æ¸¯è‚¡)
  
- [ ] éªŒè¯ API å¯†é’¥é…ç½®
  - [ ] TUSHARE_TOKEN
  - [ ] FINNHUB_API_KEY
  - [ ] EODHD_API_TOKEN
  
- [ ] åˆ›å»ºæµ‹è¯•ç”¨ä¾‹
  ```python
  # tests/test_news_engine_migration.py
  def test_news_engine_a_share():
      """æµ‹è¯•Aè‚¡æ–°é—»è·å–"""
      pass
  
  def test_news_engine_hk_share():
      """æµ‹è¯•æ¸¯è‚¡æ–°é—»è·å–"""
      pass
  
  def test_news_engine_us_share():
      """æµ‹è¯•ç¾è‚¡æ–°é—»è·å–"""
      pass
  ```

### Phase 2: å¼€å‘é˜¶æ®µï¼ˆ3-5å¤©ï¼‰

#### ä»»åŠ¡æ¸…å•
- [ ] å®ç°æ··åˆæ¨¡å¼çš„ UnifiedNewsAnalyzer
  - [ ] æ·»åŠ  `_get_news_via_engine()` æ–¹æ³•
  - [ ] æ·»åŠ æ–°ç‰ˆæ¥å£é€‚é…å±‚
  - [ ] å®ç°æ ¼å¼åŒ–å‡½æ•° `_format_news_engine_response()`
  
- [ ] ä¿®æ”¹ `unified_news_tool.py`
  - [ ] å¼•å…¥ news_engine
  - [ ] å®ç°é™çº§é€»è¾‘
  - [ ] æ·»åŠ è¯¦ç»†æ—¥å¿—
  
- [ ] æ›´æ–°é…ç½®æ–‡ä»¶
  - [ ] æ·»åŠ  news_engine é…ç½®é¡¹
  - [ ] è®¾ç½®æ•°æ®æºä¼˜å…ˆçº§
  - [ ] é…ç½®é‡è¯•ç­–ç•¥

### Phase 3: æµ‹è¯•é˜¶æ®µï¼ˆ2-3å¤©ï¼‰

#### ä»»åŠ¡æ¸…å•
- [ ] å•å…ƒæµ‹è¯•
  - [ ] æµ‹è¯•å„ä¸ªå¸‚åœºçš„æ–°é—»è·å–
  - [ ] æµ‹è¯•é™çº§é€»è¾‘
  - [ ] æµ‹è¯•é”™è¯¯å¤„ç†
  
- [ ] é›†æˆæµ‹è¯•
  - [ ] åœ¨ news_analyst_node ä¸­æµ‹è¯•
  - [ ] æµ‹è¯•ä¸åŒ LLM çš„å…¼å®¹æ€§
  - [ ] æµ‹è¯•Googleæ¨¡å‹çš„ç‰¹æ®Šå¤„ç†
  
- [ ] å‹åŠ›æµ‹è¯•
  - [ ] æµ‹è¯•é«˜å¹¶å‘åœºæ™¯
  - [ ] æµ‹è¯•ç½‘ç»œå¼‚å¸¸åœºæ™¯
  - [ ] æµ‹è¯•APIé™æµåœºæ™¯

### Phase 4: ç°åº¦å‘å¸ƒï¼ˆ1-2å‘¨ï¼‰

#### ä»»åŠ¡æ¸…å•
- [ ] å°è§„æ¨¡ç°åº¦ï¼ˆ10%æµé‡ï¼‰
  - [ ] ç›‘æ§æˆåŠŸç‡
  - [ ] ç›‘æ§å“åº”æ—¶é—´
  - [ ] æ”¶é›†é”™è¯¯æ—¥å¿—
  
- [ ] ä¸­è§„æ¨¡ç°åº¦ï¼ˆ50%æµé‡ï¼‰
  - [ ] å¯¹æ¯”æ–°æ—§ç‰ˆæœ¬æŒ‡æ ‡
  - [ ] åˆ†ææ€§èƒ½å·®å¼‚
  - [ ] ä¼˜åŒ–é—®é¢˜ç‚¹
  
- [ ] å…¨é‡å‘å¸ƒï¼ˆ100%æµé‡ï¼‰
  - [ ] å…³é—­æ—§ç‰ˆä»£ç è·¯å¾„
  - [ ] æ¸…ç†åºŸå¼ƒä»£ç 
  - [ ] æ›´æ–°æ–‡æ¡£

---

## ğŸ“ˆ ç›‘æ§æŒ‡æ ‡

### æ ¸å¿ƒæŒ‡æ ‡

| æŒ‡æ ‡ | å®šä¹‰ | ç›®æ ‡å€¼ | ç›‘æ§æ–¹å¼ |
|------|------|--------|---------|
| **æ–°é—»è·å–æˆåŠŸç‡** | æˆåŠŸè·å–åˆ°æ–°é—»çš„æ¯”ä¾‹ | > 95% | æ—¥å¿—ç»Ÿè®¡ |
| **å¹³å‡å“åº”æ—¶é—´** | ä»è¯·æ±‚åˆ°è¿”å›çš„å¹³å‡æ—¶é—´ | < 3ç§’ | æ€§èƒ½ç›‘æ§ |
| **æ•°æ®æºå¯ç”¨ç‡** | å„æ•°æ®æºçš„å¯ç”¨æ¯”ä¾‹ | > 90% | å¥åº·æ£€æŸ¥ |
| **é™çº§è§¦å‘ç‡** | è§¦å‘é™çº§é€»è¾‘çš„æ¯”ä¾‹ | < 5% | æ—¥å¿—ç»Ÿè®¡ |
| **é‡è¯•æˆåŠŸç‡** | é‡è¯•åæˆåŠŸçš„æ¯”ä¾‹ | > 80% | é‡è¯•æ—¥å¿— |

### ä¸šåŠ¡æŒ‡æ ‡

| æŒ‡æ ‡ | å®šä¹‰ | ç›‘æ§æ–¹å¼ |
|------|------|---------|
| **æ–°é—»å¹³å‡æ•°é‡** | æ¯æ¬¡è¿”å›çš„æ–°é—»å¹³å‡æ¡æ•° | æ—¥å¿—ç»Ÿè®¡ |
| **æ–°é—»æ—¶æ•ˆæ€§** | æ–°é—»å‘å¸ƒæ—¶é—´è·ä»Šçš„å¹³å‡æ—¶é•¿ | æ—¥å¿—ç»Ÿè®¡ |
| **ç›¸å…³æ€§è¯„åˆ†** | æ–°é—»ç›¸å…³æ€§çš„å¹³å‡åˆ†æ•° | æ—¥å¿—ç»Ÿè®¡ |
| **ç´§æ€¥æ–°é—»æ¯”ä¾‹** | é«˜ç´§æ€¥åº¦æ–°é—»çš„æ¯”ä¾‹ | æ—¥å¿—ç»Ÿè®¡ |

---

## ğŸ”§ å›æ»šæ–¹æ¡ˆ

### å›æ»šè§¦å‘æ¡ä»¶

æ»¡è¶³ä»¥ä¸‹ä»»ä¸€æ¡ä»¶æ—¶åº”è€ƒè™‘å›æ»š:

1. **æˆåŠŸç‡ä¸‹é™**: æ–°é—»è·å–æˆåŠŸç‡ < 85%ï¼ˆæŒç»­1å°æ—¶ï¼‰
2. **å“åº”æ—¶é—´æ¶åŒ–**: å¹³å‡å“åº”æ—¶é—´ > 10ç§’ï¼ˆæŒç»­30åˆ†é’Ÿï¼‰
3. **é”™è¯¯ç‡é£™å‡**: é”™è¯¯ç‡ > 20%ï¼ˆæŒç»­30åˆ†é’Ÿï¼‰
4. **æ ¸å¿ƒåœºæ™¯å¤±è´¥**: Aè‚¡æ–°é—»è·å–å®Œå…¨å¤±è´¥

### å›æ»šæ­¥éª¤

#### Step 1: ç«‹å³é™çº§ï¼ˆ5åˆ†é’Ÿå†…å®Œæˆï¼‰
```python
# ä¿®æ”¹ unified_news_tool.py
USE_NEWS_ENGINE = False  # ç´§æ€¥å¼€å…³ï¼Œå…³é—­æ–°ç‰ˆ

class UnifiedNewsAnalyzer:
    def get_stock_news_unified(self, stock_code: str, ...) -> str:
        if USE_NEWS_ENGINE:
            # å°è¯•æ–°ç‰ˆ...
            pass
        # ç›´æ¥ä½¿ç”¨æ—§ç‰ˆ
        return self._get_news_old_version(stock_code, ...)
```

#### Step 2: é‡å¯æœåŠ¡ï¼ˆ10åˆ†é’Ÿå†…å®Œæˆï¼‰
```bash
# é‡å¯åº”ç”¨æœåŠ¡
systemctl restart tradingagents-web
```

#### Step 3: éªŒè¯æ¢å¤ï¼ˆ15åˆ†é’Ÿå†…å®Œæˆï¼‰
- æ£€æŸ¥æˆåŠŸç‡æ˜¯å¦æ¢å¤åˆ° > 90%
- æ£€æŸ¥å“åº”æ—¶é—´æ˜¯å¦æ¢å¤åˆ° < 5ç§’
- æŠ½æŸ¥å‡ ä¸ªè‚¡ç¥¨ä»£ç éªŒè¯åŠŸèƒ½

#### Step 4: åˆ†æåŸå› ï¼ˆ1å°æ—¶å†…å®Œæˆï¼‰
- æ”¶é›†é”™è¯¯æ—¥å¿—
- åˆ†æå¤±è´¥åŸå› 
- åˆ¶å®šä¿®å¤æ–¹æ¡ˆ

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

### ç›¸å…³æ–‡æ¡£
- [æ–°é—»æ¨¡å—æ¶æ„è®¾è®¡](./æ–°é—»æ¨¡å—æ¶æ„è®¾è®¡.md)
- [æ–°é—»åŠŸèƒ½å®šä¹‰æ–‡æ¡£](./news_func_def.md)
- [Tushareæ–°é—»APIé™åˆ¶è¯´æ˜](../tushare_news_api_limitations.md)

### ä»£ç æ–‡ä»¶
- æ–°é—»åˆ†æå¸ˆ: `tradingagents/agents/analysts/news_analyst.py`
- ç»Ÿä¸€æ–°é—»å·¥å…·: `tradingagents/tools/unified_news_tool.py`
- æ—§ç‰ˆèšåˆå™¨: `tradingagents/dataflows/realtime_news_utils.py`
- æ–°ç‰ˆèšåˆå™¨: `tradingagents/news_engine/aggregator.py`
- æ–°ç‰ˆé…ç½®: `tradingagents/news_engine/config.py`

### æµ‹è¯•è„šæœ¬
- æ–°é—»å¯¹æ¯”æµ‹è¯•: `tradingagents/news_engine/test_comparison.py`
- å…¨æºæµ‹è¯•: `scripts/test_all_news_sources.py`

---

## âœ… æ€»ç»“ä¸å»ºè®®

### æ€»ä½“è¯„ä¼°

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| **æ–°ç‰ˆæˆç†Ÿåº¦** | â­â­â­â­ | æ¶æ„å®Œå–„ï¼Œä½†ç¼ºå°‘éƒ¨åˆ†å¤‡é€‰æº |
| **åˆ‡æ¢é£é™©** | â­â­â­ | ä¸­ç­‰é£é™©ï¼Œéœ€è¦å……åˆ†æµ‹è¯• |
| **æ€§èƒ½æå‡** | â­â­â­â­ | é‡è¯•æœºåˆ¶å’Œé”™è¯¯å¤„ç†æ›´å¥½ |
| **ç»´æŠ¤æˆæœ¬** | â­â­â­â­â­ | ä»£ç æ›´æ¨¡å—åŒ–ï¼Œæ˜“äºç»´æŠ¤ |

### æœ€ç»ˆå»ºè®®

**ğŸ¯ æ¨èæ–¹æ¡ˆ**: **æ··åˆæ¨¡å¼ï¼ˆå»ºè®®3ï¼‰**

**ç†ç”±**:
1. âœ… **æœ€å¤§åŒ–æˆåŠŸç‡**: ç»“åˆæ–°æ—§ç‰ˆä¼˜åŠ¿ï¼Œä¿ç•™æ‰€æœ‰å¯ç”¨æ•°æ®æº
2. âœ… **é’ˆå¯¹æ€§ä¼˜åŒ–**: ä¸åŒå¸‚åœºä½¿ç”¨æœ€é€‚åˆçš„ç­–ç•¥
3. âœ… **é£é™©å¯æ§**: ä¿ç•™é™çº§è·¯å¾„ï¼Œå‡ºé—®é¢˜å¯å¿«é€Ÿå›é€€
4. âœ… **é€æ­¥ä¼˜åŒ–**: å¯ä»¥æ ¹æ®æ•°æ®é€æ­¥è°ƒæ•´ç­–ç•¥

**å®æ–½ä¼˜å…ˆçº§**:
1. **P0ï¼ˆå¿…é¡»ï¼‰**: å®ç°æ··åˆæ¨¡å¼çš„åŸºç¡€æ¡†æ¶
2. **P0ï¼ˆå¿…é¡»ï¼‰**: å®ŒæˆAè‚¡ã€æ¸¯è‚¡ã€ç¾è‚¡çš„æµ‹è¯•ç”¨ä¾‹
3. **P1ï¼ˆé‡è¦ï¼‰**: æ·»åŠ å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦
4. **P1ï¼ˆé‡è¦ï¼‰**: å®ç°ç°åº¦å‘å¸ƒæœºåˆ¶
5. **P2ï¼ˆä¼˜åŒ–ï¼‰**: ä¼˜åŒ–æ—¥å¿—å’Œé”™è¯¯æç¤º
6. **P2ï¼ˆä¼˜åŒ–ï¼‰**: æ·»åŠ æ€§èƒ½ä¼˜åŒ–ï¼ˆç¼“å­˜ç­‰ï¼‰

**é¢„æœŸæ”¶ç›Š**:
- ğŸ“ˆ æ–°é—»è·å–æˆåŠŸç‡æå‡ 5-10%
- ğŸ”„ é”™è¯¯æ¢å¤èƒ½åŠ›æå‡ 50%+
- ğŸ—ï¸ ä»£ç å¯ç»´æŠ¤æ€§æå‡ 30%+
- âš™ï¸ é…ç½®çµæ´»æ€§æå‡ 40%+

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-11-26  
**ç»´æŠ¤è€…**: AI Assistant  
**ä¸‹æ¬¡å®¡æŸ¥**: 2025-12-26

