# æ¶ˆæ¯æœºåˆ¶é›†æˆæ£€æŸ¥æŠ¥å‘Š

## æ£€æŸ¥æ—¶é—´
2025-01-XX

## æ£€æŸ¥èŒƒå›´
1. è‚¡ç¥¨åˆ†æä»»åŠ¡å„æ­¥éª¤çš„æ¶ˆæ¯ç”Ÿäº§
2. Webé¡µé¢æ¶ˆæ¯æ¶ˆè´¹å’ŒçŠ¶æ€æ›´æ–°

## æ£€æŸ¥ç»“æœ

### âŒ é—®é¢˜1ï¼šåˆ†ææµç¨‹å„æ­¥éª¤ç¼ºå°‘æ¶ˆæ¯ç”Ÿäº§

#### 1.1 åˆ†æèŠ‚ç‚¹æ¨¡å—
**çŠ¶æ€**ï¼šéƒ¨åˆ†æ¨¡å—ä»ä½¿ç”¨æ—¥å¿—è£…é¥°å™¨

**å‘ç°**ï¼š
- âœ… å·²ä½¿ç”¨ `@log_analysis_module` çš„æ¨¡å—ï¼š
  - `tradingagents/agents/researchers/bull_researcher.py`
  - `tradingagents/agents/researchers/bear_researcher.py`
  - `tradingagents/agents/managers/research_manager.py`
  - `tradingagents/agents/trader/trader.py`
  - `tradingagents/agents/risk_mgmt/aggresive_debator.py`
  - `tradingagents/agents/risk_mgmt/conservative_debator.py`
  - `tradingagents/agents/risk_mgmt/neutral_debator.py`
  - `tradingagents/agents/managers/risk_manager.py`

- âŒ **æœªä½¿ç”¨æ¶ˆæ¯è£…é¥°å™¨**ï¼š
  - `tradingagents/agents/analysts/market_analyst.py`
  - `tradingagents/agents/analysts/fundamentals_analyst.py`
  - `tradingagents/agents/analysts/news_analyst.py`
  - `tradingagents/agents/analysts/social_media_analyst.py`

#### 1.2 åˆ†ææµç¨‹ä¸»å‡½æ•°ï¼ˆanalysis_runner.pyï¼‰
**çŠ¶æ€**ï¼šæ­¥éª¤1-12å‡æœªå‘å¸ƒæ¶ˆæ¯

**å‘ç°**ï¼š
- æ­¥éª¤1ï¼š`update_progress("ğŸš€ å¼€å§‹è‚¡ç¥¨åˆ†æ...")` - âŒ æ— æ¶ˆæ¯å‘å¸ƒ
- æ­¥éª¤2ï¼š`estimate_analysis_cost()` - âŒ æ— æ¶ˆæ¯å‘å¸ƒ
- æ­¥éª¤3-8ï¼š`prepare_analysis_steps()` - âŒ æ— æ¶ˆæ¯å‘å¸ƒ
  - æ­¥éª¤3ï¼šæ•°æ®é¢„è·å–å’ŒéªŒè¯
  - æ­¥éª¤4ï¼šç¯å¢ƒéªŒè¯
  - æ­¥éª¤5ï¼šæ„å»ºé…ç½®
  - æ­¥éª¤6ï¼šæ ¼å¼åŒ–è‚¡ç¥¨ä»£ç 
  - æ­¥éª¤7ï¼šåˆå§‹åŒ–åˆ†æå¼•æ“
  - æ­¥éª¤8ï¼šæ­¥éª¤è¾“å‡ºç›®å½•å‡†å¤‡
- æ­¥éª¤9ï¼šæ‰§è¡Œåˆ†æï¼ˆgraph.propagateï¼‰ - âœ… é€šè¿‡è£…é¥°å™¨å‘å¸ƒï¼ˆå¦‚æœå·²æ›¿æ¢ï¼‰
- æ­¥éª¤10ï¼šå¤„ç†åˆ†æç»“æœ - âŒ æ— æ¶ˆæ¯å‘å¸ƒ
- æ­¥éª¤11ï¼šè®°å½•å®Œæˆæ—¥å¿— - âŒ æ— æ¶ˆæ¯å‘å¸ƒ
- æ­¥éª¤12ï¼šä¿å­˜åˆ†æç»“æœ - âŒ æ— æ¶ˆæ¯å‘å¸ƒ

#### 1.3 è¾…åŠ©å‡½æ•°ï¼ˆanalysis_helpers.pyï¼‰
**çŠ¶æ€**ï¼šå„è¾…åŠ©å‡½æ•°æœªå‘å¸ƒæ¶ˆæ¯

**å‘ç°**ï¼š
- `estimate_analysis_cost()` - âŒ æ— æ¶ˆæ¯å‘å¸ƒ
- `prepare_stock_data_for_analysis()` - âŒ æ— æ¶ˆæ¯å‘å¸ƒ
- `validate_environment()` - âŒ æ— æ¶ˆæ¯å‘å¸ƒ
- `track_token_usage()` - âŒ æ— æ¶ˆæ¯å‘å¸ƒ
- `save_analysis_results()` - âŒ æ— æ¶ˆæ¯å‘å¸ƒ

### âŒ é—®é¢˜2ï¼šWebé¡µé¢ç¼ºå°‘æ¶ˆæ¯æ¶ˆè´¹

#### 2.1 è¿›åº¦æ˜¾ç¤ºç»„ä»¶
**çŠ¶æ€**ï¼šä½¿ç”¨è½®è¯¢æ–¹å¼ï¼Œæœªè®¢é˜…æ¶ˆæ¯

**å‘ç°**ï¼š
- `web/components/async_progress_display.py`ï¼š
  - ä½¿ç”¨ `get_progress_by_id()` è½®è¯¢è·å–è¿›åº¦
  - âŒ æœªè®¢é˜…æ¶ˆæ¯è¿›è¡Œå®æ—¶æ›´æ–°
  - ä½¿ç”¨ `st.rerun()` å’Œ `time.sleep()` å®ç°åˆ·æ–°

- `web/app.py`ï¼š
  - åŒæ ·ä½¿ç”¨ `get_progress_by_id()` è·å–è¿›åº¦
  - âŒ æœªè®¢é˜…æ¶ˆæ¯
  - ä¾èµ–è‡ªåŠ¨åˆ·æ–°æœºåˆ¶

#### 2.2 æ¶ˆæ¯è®¢é˜…æœºåˆ¶
**çŠ¶æ€**ï¼šå®Œå…¨ç¼ºå¤±

**å‘ç°**ï¼š
- âŒ æ²¡æœ‰åœ¨Webé¡µé¢åˆå§‹åŒ–æ—¶è®¢é˜…æ¶ˆæ¯
- âŒ æ²¡æœ‰æ¶ˆæ¯å›è°ƒæ›´æ–°UI
- âŒ æ²¡æœ‰å®æ—¶æ¶ˆæ¯æ¨é€æœºåˆ¶

## éœ€è¦ä¿®å¤çš„å†…å®¹

### ä¿®å¤1ï¼šä¸ºåˆ†ææµç¨‹å„æ­¥éª¤æ·»åŠ æ¶ˆæ¯ç”Ÿäº§

#### 1.1 æ›¿æ¢åˆ†æèŠ‚ç‚¹è£…é¥°å™¨
å°†ä»¥ä¸‹æ–‡ä»¶çš„ `@log_analysis_module` æ›¿æ¢ä¸º `@message_analysis_module`ï¼š
- `tradingagents/agents/analysts/market_analyst.py`
- `tradingagents/agents/analysts/fundamentals_analyst.py`
- `tradingagents/agents/analysts/news_analyst.py`
- `tradingagents/agents/analysts/social_media_analyst.py`

#### 1.2 åœ¨analysis_runner.pyä¸­æ·»åŠ æ¶ˆæ¯å‘å¸ƒ
ä¸ºå„æ­¥éª¤æ·»åŠ æ¶ˆæ¯å‘å¸ƒï¼š
- æ­¥éª¤1ï¼šå‘å¸ƒä»»åŠ¡å¼€å§‹çŠ¶æ€æ¶ˆæ¯
- æ­¥éª¤2ï¼šå‘å¸ƒæˆæœ¬ä¼°ç®—è¿›åº¦æ¶ˆæ¯
- æ­¥éª¤3-8ï¼šå‘å¸ƒå„å‡†å¤‡æ­¥éª¤çš„è¿›åº¦æ¶ˆæ¯
- æ­¥éª¤10-12ï¼šå‘å¸ƒç»“æœå¤„ç†å’Œä¿å­˜çš„è¿›åº¦æ¶ˆæ¯

#### 1.3 åœ¨analysis_helpers.pyä¸­æ·»åŠ æ¶ˆæ¯å‘å¸ƒ
ä¸ºå„è¾…åŠ©å‡½æ•°æ·»åŠ æ¶ˆæ¯å‘å¸ƒï¼š
- `estimate_analysis_cost()`ï¼šå‘å¸ƒæˆæœ¬ä¼°ç®—æ¶ˆæ¯
- `prepare_stock_data_for_analysis()`ï¼šå‘å¸ƒæ•°æ®è·å–æ¶ˆæ¯
- `validate_environment()`ï¼šå‘å¸ƒç¯å¢ƒéªŒè¯æ¶ˆæ¯
- `save_analysis_results()`ï¼šå‘å¸ƒä¿å­˜ç»“æœæ¶ˆæ¯

### ä¿®å¤2ï¼šä¸ºWebé¡µé¢æ·»åŠ æ¶ˆæ¯æ¶ˆè´¹

#### 2.1 åˆ›å»ºæ¶ˆæ¯è®¢é˜…ç»„ä»¶
åˆ›å»º `web/components/message_subscriber.py`ï¼š
- è®¢é˜…åˆ†æä»»åŠ¡ç›¸å…³çš„æ¶ˆæ¯
- å®æ—¶æ›´æ–°è¿›åº¦æ•°æ®
- è§¦å‘UIåˆ·æ–°

#### 2.2 ä¿®æ”¹è¿›åº¦æ˜¾ç¤ºç»„ä»¶
ä¿®æ”¹ `web/components/async_progress_display.py`ï¼š
- é›†æˆæ¶ˆæ¯è®¢é˜…æœºåˆ¶
- æ”¯æŒæ¶ˆæ¯é©±åŠ¨çš„å®æ—¶æ›´æ–°
- ä¿ç•™è½®è¯¢ä½œä¸ºåå¤‡æ–¹æ¡ˆ

#### 2.3 ä¿®æ”¹app.py
ä¿®æ”¹ `web/app.py`ï¼š
- åˆå§‹åŒ–æ¶ˆæ¯è®¢é˜…
- é›†æˆæ¶ˆæ¯æ›´æ–°æœºåˆ¶
- æ”¯æŒå®æ—¶çŠ¶æ€åŒæ­¥

## ä¿®å¤ä¼˜å…ˆçº§

### é«˜ä¼˜å…ˆçº§
1. âœ… æ›¿æ¢åˆ†æèŠ‚ç‚¹è£…é¥°å™¨ï¼ˆå·²å®ŒæˆåŸºç¡€æ¶æ„ï¼‰
2. âš ï¸ åœ¨analysis_runner.pyä¸­æ·»åŠ æ¶ˆæ¯å‘å¸ƒï¼ˆæ­¥éª¤1-12ï¼‰
3. âš ï¸ åœ¨analysis_helpers.pyä¸­æ·»åŠ æ¶ˆæ¯å‘å¸ƒ
4. âš ï¸ ä¸ºWebé¡µé¢æ·»åŠ æ¶ˆæ¯è®¢é˜…

### ä¸­ä¼˜å…ˆçº§
5. ä¼˜åŒ–æ¶ˆæ¯å‘å¸ƒé¢‘ç‡ï¼ˆé¿å…è¿‡åº¦å‘å¸ƒï¼‰
6. æ·»åŠ æ¶ˆæ¯é‡è¯•æœºåˆ¶
7. æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–

## æ€»ç»“

å½“å‰æ¶ˆæ¯æœºåˆ¶çš„åŸºç¡€æ¶æ„å·²æ­å»ºå®Œæˆï¼Œä½†ï¼š
- âŒ **æ¶ˆæ¯ç”Ÿäº§**ï¼šåˆ†ææµç¨‹å„æ­¥éª¤å°šæœªæ¥å…¥æ¶ˆæ¯ç”Ÿäº§
- âŒ **æ¶ˆæ¯æ¶ˆè´¹**ï¼šWebé¡µé¢å°šæœªè®¢é˜…æ¶ˆæ¯è¿›è¡Œå®æ—¶æ›´æ–°

éœ€è¦å®Œæˆä»¥ä¸‹å·¥ä½œï¼š
1. å°†æ‰€æœ‰åˆ†æèŠ‚ç‚¹è£…é¥°å™¨æ›¿æ¢ä¸ºæ¶ˆæ¯è£…é¥°å™¨
2. åœ¨åˆ†ææµç¨‹å„æ­¥éª¤ä¸­æ·»åŠ æ¶ˆæ¯å‘å¸ƒä»£ç 
3. åœ¨Webé¡µé¢ä¸­æ·»åŠ æ¶ˆæ¯è®¢é˜…å’Œå®æ—¶æ›´æ–°æœºåˆ¶

